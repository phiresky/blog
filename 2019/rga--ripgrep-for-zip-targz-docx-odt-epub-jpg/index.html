<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>rga: ripgrep, but also search in PDFs, E-Books, Office documents, zip, tar.gz, etc. - phiresky&#x27;s blog</title><meta name="description" content="rga is a line-oriented search tool that allows you to look for a regex in a multitude of file types. rga wraps the awesome ripgrep and enables it to search in pdf, docx, sqlite, jpg, zip, tar.*, movie subtitles (mkv, mp4), etc. ExamplesPDFs Say you have a large folder of papers or lecture slides,"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="alternate" type="application/rss+xml" title="RSS feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/rss.xml"/><link rel="alternate" type="application/atom+xml" title="Atom feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/atom.xml"/><link rel="alternate" type="application/json" title="JSON feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/feed.json"/><style>
          body {
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;
          }
      </style><meta name="next-head-count" content="8"/><link rel="preload" href="/blog/_next/static/css/4233340047fbc59e.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/4233340047fbc59e.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/37e3c32492601df2.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/37e3c32492601df2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script defer="" src="/blog/_next/static/chunks/2c7a9d98.f813c08763905089.js"></script><script defer="" src="/blog/_next/static/chunks/831.82344f3762765023.js"></script><script defer="" src="/blog/_next/static/chunks/174.d3d5da8bd3b94ce6.js"></script><script defer="" src="/blog/_next/static/chunks/574.81cf23fcb0e041b1.js"></script><script src="/blog/_next/static/chunks/webpack-b020d87221ea01d5.js" defer=""></script><script src="/blog/_next/static/chunks/framework-5c733c1c518e08ad.js" defer=""></script><script src="/blog/_next/static/chunks/main-4cf238684e1bcb53.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-b1b6038dad918ccb.js" defer=""></script><script src="/blog/_next/static/chunks/322-1bc22bd4b39b14f1.js" defer=""></script><script src="/blog/_next/static/chunks/127-b5c20062476709cf.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5Byear%5D/%5Bpost%5D-57ab2f8cf495e4fb.js" defer=""></script><script src="/blog/_next/static/AyFjIM2j2PLE9V7Wuo-yS/_buildManifest.js" defer=""></script><script src="/blog/_next/static/AyFjIM2j2PLE9V7Wuo-yS/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><main class="lh-copy"><div class="relative tc bg-dark-gray"><div class="mw7 center white"><div class="pv4"><h1 class="f2 normal lh-title ma0 pa0"><a class="white no-underline" href="/blog/">phiresky&#x27;s blog</a></h1><h4 class="normal o-70 ma0 pt2 pb3 ph1">About my personal projects and other stuff</h4><div><a href="https://phiresky.github.io/blog/" class="dib f6 white no-underline pa1 ma1">Blog</a><a href="https://github.com/phiresky/" class="dib f6 white no-underline pa1 ma1">GitHub</a></div></div></div></div><div class="content center mw7 pa3 pa4-ns"><h1 class="mt0 lh-title mb1">rga: ripgrep, but also search in PDFs, E-Books, Office documents, zip, tar.gz, etc.</h1><small class="db ttu o-40"><time dateTime="2019-06-16T00:00:00.000Z">Jun 16, 2019</time> • <a href="https://github.com/phiresky/blog/commits/master/posts/2019/rga--ripgrep-for-zip-targz-docx-odt-epub-jpg.md">Last Update <time dateTime="2019-06-16T00:00:00.000Z">Jul 31, 2022</time></a></small><p><a href="https://github.com/phiresky/ripgrep-all">rga</a> is a line-oriented search tool that allows you to look for a regex in a multitude of file types. rga wraps the awesome <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a> and enables it to search in pdf, docx, sqlite, jpg, zip, tar.*, movie subtitles (mkv, mp4), etc.</p><p><a href="https://github.com/phiresky/ripgrep-all"><img src="https://img.shields.io/badge/repo-github.com%2Fphiresky%2Fripgrep--all-informational.svg" title=""/></a>
<a href="https://crates.io/crates/ripgrep-all"><img src="https://img.shields.io/crates/v/ripgrep-all.svg" title=""/></a>
<a href="https://www.reddit.com/r/rustjerk/top/?sort=top&amp;t=all"><img src="https://img.shields.io/badge/concurrency-fearless-success.svg" title=""/></a></p><h2 id="examples">Examples</h2><h3 id="pdfs">PDFs</h3><p>Say you have a large folder of papers or lecture slides, and you can’t remember which one of them mentioned <code>GRU</code>s. With rga, you can just run this:</p><div><pre class="ansi2html language-none">~$ rga "GRU" slides/
<span class="ansi35">slides/2016/winter1516_lecture14.pdf</span>
Page 34:   <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span>                            LSTM
Page 35:   <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span>                            CONV
Page 38:     - Try out <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span>-RCN! (imo best model)

<span class="ansi35">slides/2018/cs231n_2018_ds08.pdf</span>
Page  3: ●   CNNs, GANs, RNNs, LSTMs, <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span>
Page 35: ● 1) temporal pooling 2) RNN (e.g. LSTM, <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span>)

<span class="ansi35">slides/2019/cs231n_2019_lecture10.pdf</span>
Page 103:   <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span> [Learning phrase representations using rnn
Page 105:    - Common to use LSTM or <span class="ansi1"></span><span class="ansi1 ansi31">GRU</span>

</pre></div><p>and it will recursively find a string in pdfs, including if some of them are zipped up.</p><p>You can do mostly the same thing with <a href="https://pdfgrep.org/"><code>pdfgrep -r</code></a>, but you will miss content in other file types and it will be much slower:</p><div><div style="text-align:center"><p>Searching in 65 pdfs with 93 slides each</p></div><div class="recharts-responsive-container" style="width:100%;height:200px"><div class="recharts-wrapper" style="position:relative;cursor:default;width:600px;height:200px"><svg class="recharts-surface" width="600" height="200" viewBox="0 0 600 200" version="1.1"><defs><clipPath id="recharts1-clip"><rect x="105" y="5" height="160" width="490"></rect></clipPath></defs><g class="recharts-layer recharts-cartesian-axis recharts-xAxis xAxis"><line type="number" orientation="bottom" width="490" height="30" x="105" y="165" class="recharts-cartesian-axis-line" stroke="#666" fill="none" x1="105" y1="165" x2="595" y2="165"></line><g class="recharts-cartesian-axis-ticks"><g class="recharts-layer recharts-cartesian-axis-tick"><line type="number" orientation="bottom" width="490" height="30" x="105" y="165" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="105" y1="171" x2="105" y2="165"></line><text type="number" orientation="bottom" width="490" height="30" x="105" y="173" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle"><tspan x="105" dy="0.71em">0</tspan></text></g><g class="recharts-layer recharts-cartesian-axis-tick"><line type="number" orientation="bottom" width="490" height="30" x="105" y="165" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="227.5" y1="171" x2="227.5" y2="165"></line><text type="number" orientation="bottom" width="490" height="30" x="227.5" y="173" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle"><tspan x="227.5" dy="0.71em">5</tspan></text></g><g class="recharts-layer recharts-cartesian-axis-tick"><line type="number" orientation="bottom" width="490" height="30" x="105" y="165" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="350" y1="171" x2="350" y2="165"></line><text type="number" orientation="bottom" width="490" height="30" x="350" y="173" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle"><tspan x="350" dy="0.71em">10</tspan></text></g><g class="recharts-layer recharts-cartesian-axis-tick"><line type="number" orientation="bottom" width="490" height="30" x="105" y="165" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="472.5" y1="171" x2="472.5" y2="165"></line><text type="number" orientation="bottom" width="490" height="30" x="472.5" y="173" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle"><tspan x="472.5" dy="0.71em">15</tspan></text></g><g class="recharts-layer recharts-cartesian-axis-tick"><line type="number" orientation="bottom" width="490" height="30" x="105" y="165" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="595" y1="171" x2="595" y2="165"></line><text type="number" orientation="bottom" width="490" height="30" x="595" y="173" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle"><tspan x="595" dy="0.71em">20</tspan></text></g></g></g><g class="recharts-layer recharts-cartesian-axis recharts-yAxis yAxis"><line type="category" width="100" orientation="left" height="160" x="5" y="5" class="recharts-cartesian-axis-line" stroke="#666" fill="none" x1="105" y1="5" x2="105" y2="165"></line><g class="recharts-cartesian-axis-ticks"><g class="recharts-layer recharts-cartesian-axis-tick"><line type="category" width="100" orientation="left" height="160" x="5" y="5" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="99" y1="31.666666666666668" x2="105" y2="31.666666666666668"></line><text type="category" width="100" orientation="left" height="160" x="97" y="31.666666666666668" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end"><tspan x="97" dy="0.355em">pdfgrep</tspan></text></g><g class="recharts-layer recharts-cartesian-axis-tick"><line type="category" width="100" orientation="left" height="160" x="5" y="5" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="99" y1="85" x2="105" y2="85"></line><text type="category" width="100" orientation="left" height="160" x="97" y="85" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end"><tspan x="97" dy="0.355em">rga (first run)</tspan></text></g><g class="recharts-layer recharts-cartesian-axis-tick"><line type="category" width="100" orientation="left" height="160" x="5" y="5" class="recharts-cartesian-axis-tick-line" stroke="#666" fill="none" x1="99" y1="138.33333333333334" x2="105" y2="138.33333333333334"></line><text type="category" width="100" orientation="left" height="160" x="97" y="138.33333333333334" stroke="none" fill="#666" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end"><tspan x="97" dy="0.355em">rga (subsequent runs)</tspan></text></g></g></g><g class="recharts-layer recharts-bar"><g class="recharts-layer recharts-bar-rectangles"><g class="recharts-layer recharts-bar-rectangle"><path name="pdfgrep" fill="#8884d8" width="469.41999999999996" height="42" x="105" y="10.333333333333334" radius="0" class="recharts-rectangle" d="M 105,10.333333333333334 h 469.41999999999996 v 42 h -469.41999999999996 Z"></path></g><g class="recharts-layer recharts-bar-rectangle"><path name="rga (first run)" fill="#8884d8" width="72.27500000000003" height="42" x="105" y="63.66666666666667" radius="0" class="recharts-rectangle" d="M 105,63.66666666666667 h 72.27500000000003 v 42 h -72.27500000000003 Z"></path></g><g class="recharts-layer recharts-bar-rectangle"><path name="rga (subsequent runs)" fill="#8884d8" width="2.2539999999999907" height="42" x="105" y="117" radius="0" class="recharts-rectangle" d="M 105,117 h 2.2539999999999907 v 42 h -2.2539999999999907 Z"></path></g></g></g></svg><div class="recharts-legend-wrapper" style="position:absolute;width:590px;height:auto;left:5px;bottom:5px"><ul class="recharts-default-legend" style="padding:0;margin:0;text-align:center"><li class="recharts-legend-item legend-item-0" style="display:inline-block;margin-right:10px"><svg class="recharts-surface" width="14" height="14" style="display:inline-block;vertical-align:middle;margin-right:4px" viewBox="0 0 32 32" version="1.1"><path stroke="none" fill="#8884d8" d="M0,4h32v24h-32z" class="recharts-legend-icon"></path></svg><span class="recharts-legend-item-text" style="color:#8884d8">run time (seconds, lower is better)</span></li></ul></div><div class="recharts-tooltip-wrapper" style="transform:translate(undefinedpx, undefinedpx);-webkit-transform:translate(undefinedpx, undefinedpx);-moz-transform:translate(undefinedpx, undefinedpx);-o-transform:translate(undefinedpx, undefinedpx);-ms-transform:translate(undefinedpx, undefinedpx);pointer-events:none;visibility:hidden;position:absolute;top:0;left:0"><div class="recharts-default-tooltip" style="margin:0;padding:10px;background-color:#fff;border:1px solid #ccc;white-space:nowrap"><p class="recharts-tooltip-label" style="margin:0"></p></div></div></div></div></div><p>On the first run rga is mostly faster because of multithreading, but on subsequent runs (with the same files but any regex query) rga will cache the text extraction, so it becomes almost as fast as searching in plain text files. All runs were done with a warm FS cache.</p><h3 id="other-files">Other files</h3><p>rga will recursively descend into archives and match text in every file type it knows.</p><p>Here is an example directory with different file types:</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>demo
</span>├── greeting.mkv
<!-- -->├── hello.odt
<!-- -->├── hello.sqlite3
<!-- -->└── somearchive.zip
<!-- -->    ├── dir
<!-- -->    │   ├── greeting.docx
<!-- -->    │   └── inner.tar.gz
<!-- -->    │       └── greeting.pdf
<!-- -->    └── greeting.epub</code></pre><p>(see the actual directory <a href="https://github.com/phiresky/ripgrep-all/tree/master/exampledir/demo">here</a>)</p><div><pre class="ansi2html language-none">~$ rga "hello" demo/

<span class="ansi35">demo/greeting.mkv</span>
metadata: chapters.chapter.0.tags.title="Chapter 1: <span class="ansi1"></span><span class="ansi1 ansi31">Hello</span>"
00:08.398 --&gt; 00:11.758: <span class="ansi1"></span><span class="ansi1 ansi31">Hello</span> from a movie!

<span class="ansi35">demo/hello.odt</span>
<span class="ansi1"></span><span class="ansi1 ansi31">Hello</span> from an OpenDocument file!

<span class="ansi35">demo/hello.sqlite3</span>
tbl: greeting='<span class="ansi1"></span><span class="ansi1 ansi31">hello</span>', from='sqlite database!'

<span class="ansi35">demo/somearchive.zip</span>
dir/greeting.docx: <span class="ansi1"></span><span class="ansi1 ansi31">Hello</span> from a MS Office document!
dir/inner.tar.gz: greeting.pdf: Page 1: <span class="ansi1"></span><span class="ansi1 ansi31">Hello</span> from a PDF!
greeting.epub: <span class="ansi1"></span><span class="ansi1 ansi31">Hello</span> from an E-Book!
</pre></div><p>It can even search jpg / png images and scanned pdfs using OCR, though this is disabled by default since it is not useful that often and pretty slow.</p><div><pre class="ansi2html language-none">~$ # find screenshot of crates.io
~$ rga crates ~/screenshots --rga-adapters=+pdfpages,tesseract
<span class="ansi35">screenshots/2019-06-14-19-01-10.png</span>
<span class="ansi1"></span><span class="ansi1 ansi31">crates</span>.io I Browse All <span class="ansi1"></span><span class="ansi1 ansi31">Crates</span>  Docs v
Documentation Repository Dependent <span class="ansi1"></span><span class="ansi1 ansi31">crates</span>

~$ # there it is!
</pre></div><h2 id="setup">Setup</h2><p>Linux, Windows and OSX binaries are available in GitHub releases. See <a href="https://github.com/phiresky/ripgrep-all#installation">the readme</a> for more information.</p><p>For Arch Linux, I have packaged <code>rga</code> in the AUR: <a href="https://aur.archlinux.org/packages/ripgrep-all/"><code>yay -S ripgrep-all</code></a></p><h2 id="technical-details">Technical details</h2><p>The code and a few more details are here: <a href="https://github.com/phiresky/ripgrep-all" class="auto-linked">https://github.com/phiresky/ripgrep-all</a></p><p><code>rga</code> simply runs ripgrep (<code>rg</code>) with some options set, especially <code>--pre=rga-preproc</code> and <code>--pre-glob</code>.</p><p><code>rga-preproc [fname]</code> will match an <span class="quoted">&quot;<!-- -->adapter<!-- -->&quot;</span> to the given file based on either it’s filename or it’s mime type (if <code>--rga-accurate</code> is given). You can see all adapters currently included in <a href="https://github.com/phiresky/ripgrep-all/tree/master/src/adapters">src/adapters</a>.</p><p>Some rga adapters run external binaries to do the actual work (such as pandoc or ffmpeg), usually by writing to stdin and reading from stdout. Others use a Rust library or bindings to achieve the same effect (like sqlite or zip).</p><p>To read archives, the <code>zip</code> and <code>tar</code> libraries are used, which work fully in a streaming fashion - this means that the RAM usage is low and no data is ever actually extracted to disk!</p><p>Most adapters read the files from a <a href="https://doc.rust-lang.org/std/io/trait.Read.html">Read</a>, so they work completely on streamed data (that can come from anywhere including within nested archives).</p><p>During the extraction, rga-preproc will compress the data with ZSTD to a memory cache while simultaneously writing it uncompressed to stdout. After completion, if the memory cache is smaller than 2MByte, it is written to a <a href="https://docs.rs/rkv/0.9.6/rkv/">rkv</a> cache. The cache is keyed by (adapter, filename, mtime), so if a file changes it’s content is extracted again.</p><h2 id="future-work">Future Work</h2><ul><li>7z adapter (couldn’t find a nice to use Rust library with streaming)</li><li>Allow per-adapter configuration options (probably via env (RGA_ADAPTERXYZ_CONF=json))</li><li>Maybe use a different disk kv-store as a cache instead of rkv, because I had some <a href="https://github.com/phiresky/ripgrep-all/blob/05835c1c42bc3575023a81e5494c5530078730fc/src/preproc_cache.rs#L30">weird problems</a> with that. SQLite is great. All other Rust alternatives I could find don’t allow writing from multiple processes.</li><li>Tests!</li><li>There’s some more (mostly technical) todos in the code I don’t know how to fix. Help wanted.</li><li>Other <a href="https://github.com/phiresky/ripgrep-all/issues">open issues</a></li></ul><h2 id="similar-tools">Similar tools</h2><ul><li><a href="https://pdfgrep.org/">pdfgrep</a></li><li><a href="https://gist.github.com/phiresky/5025490526ba70663ab3b8af6c40a8db">this gist</a> has my proof of concept version of a caching extractor to use ripgrep as a replacement for pdfgrep.</li><li><a href="https://gist.github.com/ColonolBuendia/314826e37ec35c616d70506c38dc65aa">this gist</a> is a more extensive preprocessing script by <a href="https://github.com/ColonolBuendia">@ColonolBuendia</a></li><li><a href="https://github.com/wofr06/lesspipe">lesspipe</a> is a tool to make <code>less</code> work with many different file types. Different usecase, but similar in what it does.</li></ul></div><footer class="center w5 f6 tc mt4"><p><a href="https://github.com/phiresky/blog/blob/master/posts/2019/rga--ripgrep-for-zip-targz-docx-odt-epub-jpg.md">View post source on GitHub</a></p></footer><div><script>/* yes, I know... fite me */
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
  function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='https://www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-39197996-3','auto');ga('send','pageview');
</script></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"filename":"2019/rga--ripgrep-for-zip-targz-docx-odt-epub-jpg.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2019-06-16","references":[],"title":"rga: ripgrep, but also search in PDFs, E-Books, Office documents, zip, tar.gz, etc.","updated":"2022-07-31","url2cite-link-output":"sup"},"preview":"rga is a line-oriented search tool that allows you to look for a regex in a multitude of file types. rga wraps the awesome ripgrep and enables it to search in pdf, docx, sqlite, jpg, zip, tar.*, movie subtitles (mkv, mp4), etc. ExamplesPDFs Say you have a large folder of papers or lecture slides,","content_ast":[{"t":"Para","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"rga"}],["https://github.com/phiresky/ripgrep-all",""]]},{"t":"Str","c":" is a line-oriented search tool that allows you to look for a regex in a multitude of file types. rga wraps the awesome "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"ripgrep"}],["https://github.com/BurntSushi/ripgrep",""]]},{"t":"Str","c":" and enables it to search in pdf, docx, sqlite, jpg, zip, tar.*, movie subtitles (mkv, mp4), etc."}]},{"t":"Para","c":[{"t":"Link","c":[["",[],[]],[{"t":"Image","c":[["",[],[]],[],["https://img.shields.io/badge/repo-github.com%2Fphiresky%2Fripgrep--all-informational.svg",""]]}],["https://github.com/phiresky/ripgrep-all",""]]},{"t":"SoftBreak"},{"t":"Link","c":[["",[],[]],[{"t":"Image","c":[["",[],[]],[],["https://img.shields.io/crates/v/ripgrep-all.svg",""]]}],["https://crates.io/crates/ripgrep-all",""]]},{"t":"SoftBreak"},{"t":"Link","c":[["",[],[]],[{"t":"Image","c":[["",[],[]],[],["https://img.shields.io/badge/concurrency-fearless-success.svg",""]]}],["https://www.reddit.com/r/rustjerk/top/?sort=top\u0026t=all",""]]}]},{"t":"Header","c":[2,["examples",[],[]],[{"t":"Str","c":"Examples"}]]},{"t":"Header","c":[3,["pdfs",[],[]],[{"t":"Str","c":"PDFs"}]]},{"t":"Para","c":[{"t":"Str","c":"Say you have a large folder of papers or lecture slides, and you can’t remember which one of them mentioned "},{"t":"Code","c":[["",[],[]],"GRU"]},{"t":"Str","c":"s. With rga, you can just run this:"}]},{"t":"RawBlock","c":["html","\u003cpre class=\"ansi2html language-none\"\u003e~$ rga \"GRU\" slides/\n\u003cspan class=\"ansi35\"\u003eslides/2016/winter1516_lecture14.pdf\u003c/span\u003e\nPage 34:   \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e                            LSTM\nPage 35:   \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e                            CONV\nPage 38:     - Try out \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e-RCN! (imo best model)\n\n\u003cspan class=\"ansi35\"\u003eslides/2018/cs231n_2018_ds08.pdf\u003c/span\u003e\nPage  3: ●   CNNs, GANs, RNNs, LSTMs, \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e\nPage 35: ● 1) temporal pooling 2) RNN (e.g. LSTM, \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e)\n\n\u003cspan class=\"ansi35\"\u003eslides/2019/cs231n_2019_lecture10.pdf\u003c/span\u003e\nPage 103:   \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e [Learning phrase representations using rnn\nPage 105:    - Common to use LSTM or \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e\n\n\u003c/pre\u003e"]},{"t":"Para","c":[{"t":"Str","c":"and it will recursively find a string in pdfs, including if some of them are zipped up."}]},{"t":"Para","c":[{"t":"Str","c":"You can do mostly the same thing with "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"pdfgrep -r"]}],["https://pdfgrep.org/",""]]},{"t":"Str","c":", but you will miss content in other file types and it will be much slower:"}]},{"t":"CodeBlock","c":[["",["barchart"],[]],"title: Searching in 65 pdfs with 93 slides each\nseries: run time (seconds, lower is better)\ndata:\n   pdfgrep: 19.16\n   rga (first run): 2.95\n   rga (subsequent runs): 0.092"]},{"t":"Para","c":[{"t":"Str","c":"On the first run rga is mostly faster because of multithreading, but on subsequent runs (with the same files but any regex query) rga will cache the text extraction, so it becomes almost as fast as searching in plain text files. All runs were done with a warm FS cache."}]},{"t":"Header","c":[3,["other-files",[],[]],[{"t":"Str","c":"Other files"}]]},{"t":"Para","c":[{"t":"Str","c":"rga will recursively descend into archives and match text in every file type it knows."}]},{"t":"Para","c":[{"t":"Str","c":"Here is an example directory with different file types:"}]},{"t":"CodeBlock","c":[["",[],[]],"demo\n├── greeting.mkv\n├── hello.odt\n├── hello.sqlite3\n└── somearchive.zip\n    ├── dir\n    │   ├── greeting.docx\n    │   └── inner.tar.gz\n    │       └── greeting.pdf\n    └── greeting.epub"]},{"t":"Para","c":[{"t":"Str","c":"(see the actual directory "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"here"}],["https://github.com/phiresky/ripgrep-all/tree/master/exampledir/demo",""]]},{"t":"Str","c":")"}]},{"t":"RawBlock","c":["html","\u003cpre class=\"ansi2html language-none\"\u003e~$ rga \"hello\" demo/\n\n\u003cspan class=\"ansi35\"\u003edemo/greeting.mkv\u003c/span\u003e\nmetadata: chapters.chapter.0.tags.title=\"Chapter 1: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e\"\n00:08.398 --\u0026gt; 00:11.758: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from a movie!\n\n\u003cspan class=\"ansi35\"\u003edemo/hello.odt\u003c/span\u003e\n\u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from an OpenDocument file!\n\n\u003cspan class=\"ansi35\"\u003edemo/hello.sqlite3\u003c/span\u003e\ntbl: greeting='\u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003ehello\u003c/span\u003e', from='sqlite database!'\n\n\u003cspan class=\"ansi35\"\u003edemo/somearchive.zip\u003c/span\u003e\ndir/greeting.docx: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from a MS Office document!\ndir/inner.tar.gz: greeting.pdf: Page 1: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from a PDF!\ngreeting.epub: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from an E-Book!\n\u003c/pre\u003e"]},{"t":"Para","c":[{"t":"Str","c":"It can even search jpg / png images and scanned pdfs using OCR, though this is disabled by default since it is not useful that often and pretty slow."}]},{"t":"RawBlock","c":["html","\u003cpre class=\"ansi2html language-none\"\u003e~$ # find screenshot of crates.io\n~$ rga crates ~/screenshots --rga-adapters=+pdfpages,tesseract\n\u003cspan class=\"ansi35\"\u003escreenshots/2019-06-14-19-01-10.png\u003c/span\u003e\n\u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003ecrates\u003c/span\u003e.io I Browse All \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eCrates\u003c/span\u003e  Docs v\nDocumentation Repository Dependent \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003ecrates\u003c/span\u003e\n\n~$ # there it is!\n\u003c/pre\u003e"]},{"t":"Header","c":[2,["setup",[],[]],[{"t":"Str","c":"Setup"}]]},{"t":"Para","c":[{"t":"Str","c":"Linux, Windows and OSX binaries are available in GitHub releases. See "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"the readme"}],["https://github.com/phiresky/ripgrep-all#installation",""]]},{"t":"Str","c":" for more information."}]},{"t":"Para","c":[{"t":"Str","c":"For Arch Linux, I have packaged "},{"t":"Code","c":[["",[],[]],"rga"]},{"t":"Str","c":" in the AUR: "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"yay -S ripgrep-all"]}],["https://aur.archlinux.org/packages/ripgrep-all/",""]]}]},{"t":"Header","c":[2,["technical-details",[],[]],[{"t":"Str","c":"Technical details"}]]},{"t":"Para","c":[{"t":"Str","c":"The code and a few more details are here: "},{"t":"Link","c":[["",["auto-linked"],[]],[{"t":"Str","c":"https://github.com/phiresky/ripgrep-all"}],["https://github.com/phiresky/ripgrep-all",""]]}]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"rga"]},{"t":"Str","c":" simply runs ripgrep ("},{"t":"Code","c":[["",[],[]],"rg"]},{"t":"Str","c":") with some options set, especially "},{"t":"Code","c":[["",[],[]],"--pre=rga-preproc"]},{"t":"Str","c":" and "},{"t":"Code","c":[["",[],[]],"--pre-glob"]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"rga-preproc [fname]"]},{"t":"Str","c":" will match an "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"adapter"}]]},{"t":"Str","c":" to the given file based on either it’s filename or it’s mime type (if "},{"t":"Code","c":[["",[],[]],"--rga-accurate"]},{"t":"Str","c":" is given). You can see all adapters currently included in "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"src/adapters"}],["https://github.com/phiresky/ripgrep-all/tree/master/src/adapters",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"Some rga adapters run external binaries to do the actual work (such as pandoc or ffmpeg), usually by writing to stdin and reading from stdout. Others use a Rust library or bindings to achieve the same effect (like sqlite or zip)."}]},{"t":"Para","c":[{"t":"Str","c":"To read archives, the "},{"t":"Code","c":[["",[],[]],"zip"]},{"t":"Str","c":" and "},{"t":"Code","c":[["",[],[]],"tar"]},{"t":"Str","c":" libraries are used, which work fully in a streaming fashion - this means that the RAM usage is low and no data is ever actually extracted to disk!"}]},{"t":"Para","c":[{"t":"Str","c":"Most adapters read the files from a "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Read"}],["https://doc.rust-lang.org/std/io/trait.Read.html",""]]},{"t":"Str","c":", so they work completely on streamed data (that can come from anywhere including within nested archives)."}]},{"t":"Para","c":[{"t":"Str","c":"During the extraction, rga-preproc will compress the data with ZSTD to a memory cache while simultaneously writing it uncompressed to stdout. After completion, if the memory cache is smaller than 2MByte, it is written to a "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"rkv"}],["https://docs.rs/rkv/0.9.6/rkv/",""]]},{"t":"Str","c":" cache. The cache is keyed by (adapter, filename, mtime), so if a file changes it’s content is extracted again."}]},{"t":"Header","c":[2,["future-work",[],[]],[{"t":"Str","c":"Future Work"}]]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"7z adapter (couldn’t find a nice to use Rust library with streaming)"}]}],[{"t":"Plain","c":[{"t":"Str","c":"Allow per-adapter configuration options (probably via env (RGA_ADAPTERXYZ_CONF=json))"}]}],[{"t":"Plain","c":[{"t":"Str","c":"Maybe use a different disk kv-store as a cache instead of rkv, because I had some "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"weird problems"}],["https://github.com/phiresky/ripgrep-all/blob/05835c1c42bc3575023a81e5494c5530078730fc/src/preproc_cache.rs#L30",""]]},{"t":"Str","c":" with that. SQLite is great. All other Rust alternatives I could find don’t allow writing from multiple processes."}]}],[{"t":"Plain","c":[{"t":"Str","c":"Tests!"}]}],[{"t":"Plain","c":[{"t":"Str","c":"There’s some more (mostly technical) todos in the code I don’t know how to fix. Help wanted."}]}],[{"t":"Plain","c":[{"t":"Str","c":"Other "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"open issues"}],["https://github.com/phiresky/ripgrep-all/issues",""]]}]}]]},{"t":"Header","c":[2,["similar-tools",[],[]],[{"t":"Str","c":"Similar tools"}]]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pdfgrep"}],["https://pdfgrep.org/",""]]}]}],[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"this gist"}],["https://gist.github.com/phiresky/5025490526ba70663ab3b8af6c40a8db",""]]},{"t":"Str","c":" has my proof of concept version of a caching extractor to use ripgrep as a replacement for pdfgrep."}]}],[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"this gist"}],["https://gist.github.com/ColonolBuendia/314826e37ec35c616d70506c38dc65aa",""]]},{"t":"Str","c":" is a more extensive preprocessing script by "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"@ColonolBuendia"}],["https://github.com/ColonolBuendia",""]]}]}],[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"lesspipe"}],["https://github.com/wofr06/lesspipe",""]]},{"t":"Str","c":" is a tool to make "},{"t":"Code","c":[["",[],[]],"less"]},{"t":"Str","c":" work with many different file types. Different usecase, but similar in what it does."}]}]]}],"default":{"filename":"2019/rga--ripgrep-for-zip-targz-docx-odt-epub-jpg.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2019-06-16","references":[],"title":"rga: ripgrep, but also search in PDFs, E-Books, Office documents, zip, tar.gz, etc.","updated":"2022-07-31","url2cite-link-output":"sup"},"preview":"rga is a line-oriented search tool that allows you to look for a regex in a multitude of file types. rga wraps the awesome ripgrep and enables it to search in pdf, docx, sqlite, jpg, zip, tar.*, movie subtitles (mkv, mp4), etc. ExamplesPDFs Say you have a large folder of papers or lecture slides,","content_ast":[{"t":"Para","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"rga"}],["https://github.com/phiresky/ripgrep-all",""]]},{"t":"Str","c":" is a line-oriented search tool that allows you to look for a regex in a multitude of file types. rga wraps the awesome "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"ripgrep"}],["https://github.com/BurntSushi/ripgrep",""]]},{"t":"Str","c":" and enables it to search in pdf, docx, sqlite, jpg, zip, tar.*, movie subtitles (mkv, mp4), etc."}]},{"t":"Para","c":[{"t":"Link","c":[["",[],[]],[{"t":"Image","c":[["",[],[]],[],["https://img.shields.io/badge/repo-github.com%2Fphiresky%2Fripgrep--all-informational.svg",""]]}],["https://github.com/phiresky/ripgrep-all",""]]},{"t":"SoftBreak"},{"t":"Link","c":[["",[],[]],[{"t":"Image","c":[["",[],[]],[],["https://img.shields.io/crates/v/ripgrep-all.svg",""]]}],["https://crates.io/crates/ripgrep-all",""]]},{"t":"SoftBreak"},{"t":"Link","c":[["",[],[]],[{"t":"Image","c":[["",[],[]],[],["https://img.shields.io/badge/concurrency-fearless-success.svg",""]]}],["https://www.reddit.com/r/rustjerk/top/?sort=top\u0026t=all",""]]}]},{"t":"Header","c":[2,["examples",[],[]],[{"t":"Str","c":"Examples"}]]},{"t":"Header","c":[3,["pdfs",[],[]],[{"t":"Str","c":"PDFs"}]]},{"t":"Para","c":[{"t":"Str","c":"Say you have a large folder of papers or lecture slides, and you can’t remember which one of them mentioned "},{"t":"Code","c":[["",[],[]],"GRU"]},{"t":"Str","c":"s. With rga, you can just run this:"}]},{"t":"RawBlock","c":["html","\u003cpre class=\"ansi2html language-none\"\u003e~$ rga \"GRU\" slides/\n\u003cspan class=\"ansi35\"\u003eslides/2016/winter1516_lecture14.pdf\u003c/span\u003e\nPage 34:   \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e                            LSTM\nPage 35:   \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e                            CONV\nPage 38:     - Try out \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e-RCN! (imo best model)\n\n\u003cspan class=\"ansi35\"\u003eslides/2018/cs231n_2018_ds08.pdf\u003c/span\u003e\nPage  3: ●   CNNs, GANs, RNNs, LSTMs, \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e\nPage 35: ● 1) temporal pooling 2) RNN (e.g. LSTM, \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e)\n\n\u003cspan class=\"ansi35\"\u003eslides/2019/cs231n_2019_lecture10.pdf\u003c/span\u003e\nPage 103:   \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e [Learning phrase representations using rnn\nPage 105:    - Common to use LSTM or \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eGRU\u003c/span\u003e\n\n\u003c/pre\u003e"]},{"t":"Para","c":[{"t":"Str","c":"and it will recursively find a string in pdfs, including if some of them are zipped up."}]},{"t":"Para","c":[{"t":"Str","c":"You can do mostly the same thing with "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"pdfgrep -r"]}],["https://pdfgrep.org/",""]]},{"t":"Str","c":", but you will miss content in other file types and it will be much slower:"}]},{"t":"CodeBlock","c":[["",["barchart"],[]],"title: Searching in 65 pdfs with 93 slides each\nseries: run time (seconds, lower is better)\ndata:\n   pdfgrep: 19.16\n   rga (first run): 2.95\n   rga (subsequent runs): 0.092"]},{"t":"Para","c":[{"t":"Str","c":"On the first run rga is mostly faster because of multithreading, but on subsequent runs (with the same files but any regex query) rga will cache the text extraction, so it becomes almost as fast as searching in plain text files. All runs were done with a warm FS cache."}]},{"t":"Header","c":[3,["other-files",[],[]],[{"t":"Str","c":"Other files"}]]},{"t":"Para","c":[{"t":"Str","c":"rga will recursively descend into archives and match text in every file type it knows."}]},{"t":"Para","c":[{"t":"Str","c":"Here is an example directory with different file types:"}]},{"t":"CodeBlock","c":[["",[],[]],"demo\n├── greeting.mkv\n├── hello.odt\n├── hello.sqlite3\n└── somearchive.zip\n    ├── dir\n    │   ├── greeting.docx\n    │   └── inner.tar.gz\n    │       └── greeting.pdf\n    └── greeting.epub"]},{"t":"Para","c":[{"t":"Str","c":"(see the actual directory "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"here"}],["https://github.com/phiresky/ripgrep-all/tree/master/exampledir/demo",""]]},{"t":"Str","c":")"}]},{"t":"RawBlock","c":["html","\u003cpre class=\"ansi2html language-none\"\u003e~$ rga \"hello\" demo/\n\n\u003cspan class=\"ansi35\"\u003edemo/greeting.mkv\u003c/span\u003e\nmetadata: chapters.chapter.0.tags.title=\"Chapter 1: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e\"\n00:08.398 --\u0026gt; 00:11.758: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from a movie!\n\n\u003cspan class=\"ansi35\"\u003edemo/hello.odt\u003c/span\u003e\n\u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from an OpenDocument file!\n\n\u003cspan class=\"ansi35\"\u003edemo/hello.sqlite3\u003c/span\u003e\ntbl: greeting='\u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003ehello\u003c/span\u003e', from='sqlite database!'\n\n\u003cspan class=\"ansi35\"\u003edemo/somearchive.zip\u003c/span\u003e\ndir/greeting.docx: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from a MS Office document!\ndir/inner.tar.gz: greeting.pdf: Page 1: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from a PDF!\ngreeting.epub: \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eHello\u003c/span\u003e from an E-Book!\n\u003c/pre\u003e"]},{"t":"Para","c":[{"t":"Str","c":"It can even search jpg / png images and scanned pdfs using OCR, though this is disabled by default since it is not useful that often and pretty slow."}]},{"t":"RawBlock","c":["html","\u003cpre class=\"ansi2html language-none\"\u003e~$ # find screenshot of crates.io\n~$ rga crates ~/screenshots --rga-adapters=+pdfpages,tesseract\n\u003cspan class=\"ansi35\"\u003escreenshots/2019-06-14-19-01-10.png\u003c/span\u003e\n\u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003ecrates\u003c/span\u003e.io I Browse All \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003eCrates\u003c/span\u003e  Docs v\nDocumentation Repository Dependent \u003cspan class=\"ansi1\"\u003e\u003c/span\u003e\u003cspan class=\"ansi1 ansi31\"\u003ecrates\u003c/span\u003e\n\n~$ # there it is!\n\u003c/pre\u003e"]},{"t":"Header","c":[2,["setup",[],[]],[{"t":"Str","c":"Setup"}]]},{"t":"Para","c":[{"t":"Str","c":"Linux, Windows and OSX binaries are available in GitHub releases. See "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"the readme"}],["https://github.com/phiresky/ripgrep-all#installation",""]]},{"t":"Str","c":" for more information."}]},{"t":"Para","c":[{"t":"Str","c":"For Arch Linux, I have packaged "},{"t":"Code","c":[["",[],[]],"rga"]},{"t":"Str","c":" in the AUR: "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"yay -S ripgrep-all"]}],["https://aur.archlinux.org/packages/ripgrep-all/",""]]}]},{"t":"Header","c":[2,["technical-details",[],[]],[{"t":"Str","c":"Technical details"}]]},{"t":"Para","c":[{"t":"Str","c":"The code and a few more details are here: "},{"t":"Link","c":[["",["auto-linked"],[]],[{"t":"Str","c":"https://github.com/phiresky/ripgrep-all"}],["https://github.com/phiresky/ripgrep-all",""]]}]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"rga"]},{"t":"Str","c":" simply runs ripgrep ("},{"t":"Code","c":[["",[],[]],"rg"]},{"t":"Str","c":") with some options set, especially "},{"t":"Code","c":[["",[],[]],"--pre=rga-preproc"]},{"t":"Str","c":" and "},{"t":"Code","c":[["",[],[]],"--pre-glob"]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"rga-preproc [fname]"]},{"t":"Str","c":" will match an "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"adapter"}]]},{"t":"Str","c":" to the given file based on either it’s filename or it’s mime type (if "},{"t":"Code","c":[["",[],[]],"--rga-accurate"]},{"t":"Str","c":" is given). You can see all adapters currently included in "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"src/adapters"}],["https://github.com/phiresky/ripgrep-all/tree/master/src/adapters",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"Some rga adapters run external binaries to do the actual work (such as pandoc or ffmpeg), usually by writing to stdin and reading from stdout. Others use a Rust library or bindings to achieve the same effect (like sqlite or zip)."}]},{"t":"Para","c":[{"t":"Str","c":"To read archives, the "},{"t":"Code","c":[["",[],[]],"zip"]},{"t":"Str","c":" and "},{"t":"Code","c":[["",[],[]],"tar"]},{"t":"Str","c":" libraries are used, which work fully in a streaming fashion - this means that the RAM usage is low and no data is ever actually extracted to disk!"}]},{"t":"Para","c":[{"t":"Str","c":"Most adapters read the files from a "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Read"}],["https://doc.rust-lang.org/std/io/trait.Read.html",""]]},{"t":"Str","c":", so they work completely on streamed data (that can come from anywhere including within nested archives)."}]},{"t":"Para","c":[{"t":"Str","c":"During the extraction, rga-preproc will compress the data with ZSTD to a memory cache while simultaneously writing it uncompressed to stdout. After completion, if the memory cache is smaller than 2MByte, it is written to a "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"rkv"}],["https://docs.rs/rkv/0.9.6/rkv/",""]]},{"t":"Str","c":" cache. The cache is keyed by (adapter, filename, mtime), so if a file changes it’s content is extracted again."}]},{"t":"Header","c":[2,["future-work",[],[]],[{"t":"Str","c":"Future Work"}]]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"7z adapter (couldn’t find a nice to use Rust library with streaming)"}]}],[{"t":"Plain","c":[{"t":"Str","c":"Allow per-adapter configuration options (probably via env (RGA_ADAPTERXYZ_CONF=json))"}]}],[{"t":"Plain","c":[{"t":"Str","c":"Maybe use a different disk kv-store as a cache instead of rkv, because I had some "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"weird problems"}],["https://github.com/phiresky/ripgrep-all/blob/05835c1c42bc3575023a81e5494c5530078730fc/src/preproc_cache.rs#L30",""]]},{"t":"Str","c":" with that. SQLite is great. All other Rust alternatives I could find don’t allow writing from multiple processes."}]}],[{"t":"Plain","c":[{"t":"Str","c":"Tests!"}]}],[{"t":"Plain","c":[{"t":"Str","c":"There’s some more (mostly technical) todos in the code I don’t know how to fix. Help wanted."}]}],[{"t":"Plain","c":[{"t":"Str","c":"Other "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"open issues"}],["https://github.com/phiresky/ripgrep-all/issues",""]]}]}]]},{"t":"Header","c":[2,["similar-tools",[],[]],[{"t":"Str","c":"Similar tools"}]]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pdfgrep"}],["https://pdfgrep.org/",""]]}]}],[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"this gist"}],["https://gist.github.com/phiresky/5025490526ba70663ab3b8af6c40a8db",""]]},{"t":"Str","c":" has my proof of concept version of a caching extractor to use ripgrep as a replacement for pdfgrep."}]}],[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"this gist"}],["https://gist.github.com/ColonolBuendia/314826e37ec35c616d70506c38dc65aa",""]]},{"t":"Str","c":" is a more extensive preprocessing script by "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"@ColonolBuendia"}],["https://github.com/ColonolBuendia",""]]}]}],[{"t":"Plain","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"lesspipe"}],["https://github.com/wofr06/lesspipe",""]]},{"t":"Str","c":" is a tool to make "},{"t":"Code","c":[["",[],[]],"less"]},{"t":"Str","c":" work with many different file types. Different usecase, but similar in what it does."}]}]]}]}}},"__N_SSG":true},"page":"/[year]/[post]","query":{"year":"2019","post":"rga--ripgrep-for-zip-targz-docx-odt-epub-jpg"},"buildId":"AyFjIM2j2PLE9V7Wuo-yS","assetPrefix":"/blog","isFallback":false,"dynamicIds":[8574],"gsp":true,"scriptLoader":[]}</script></body></html>