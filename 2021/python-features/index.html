<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>10 underused features of modern Python [incomplete] - phiresky&#x27;s blog</title><meta name="description" content="Named tupleautomatic constructor generation etcstrong typingimmutablesame memory usage as normal tuplesdefault valuesmore safety than tuples, access params.name like objects, order does not mattercompatible API with tuplesTyping A must if you’re used to typed programming languages. Makes it much"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="alternate" type="application/rss+xml" title="RSS feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/rss.xml"/><link rel="alternate" type="application/atom+xml" title="Atom feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/atom.xml"/><link rel="alternate" type="application/json" title="JSON feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/feed.json"/><style>
          body {
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;
          }
      </style><meta name="next-head-count" content="8"/><link rel="preload" href="/blog/_next/static/css/90cc66ac064ddd688e6f.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/90cc66ac064ddd688e6f.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/7d098b8d162156058bea.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/7d098b8d162156058bea.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-fe03425c607e25a05075.js"></script><script src="/blog/_next/static/chunks/webpack-1cbd345cb52c5f405524.js" defer=""></script><script src="/blog/_next/static/chunks/framework-64b8678db95e83965559.js" defer=""></script><script src="/blog/_next/static/chunks/main-05a3bf6cc7bca8354a13.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-1f7b68177c797473a29c.js" defer=""></script><script src="/blog/_next/static/chunks/245-fdc48ef739825c09f567.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5Byear%5D/%5Bpost%5D-223ad63bd2568d593a28.js" defer=""></script><script src="/blog/_next/static/NlBwkDxJnMQWkSmnzlBWh/_buildManifest.js" defer=""></script><script src="/blog/_next/static/NlBwkDxJnMQWkSmnzlBWh/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><main class="lh-copy"><div class="relative tc bg-dark-gray"><div class="mw7 center white"><div class="pv4"><h1 class="f2 normal lh-title ma0 pa0"><a class="white no-underline" href="/blog/">phiresky&#x27;s blog</a></h1><h4 class="normal o-70 ma0 pt2 pb3 ph1">About my personal projects and other stuff</h4><div><a href="https://phiresky.github.io/blog/" class="dib f6 white no-underline pa1 ma1">Blog</a><a href="https://github.com/phiresky/" class="dib f6 white no-underline pa1 ma1">GitHub</a></div></div></div></div><div class="content center mw7 pa3 pa4-ns"><h1 class="mt0 lh-title mb1">10 underused features of modern Python [incomplete]</h1><small class="db ttu o-40"><time dateTime="2021-02-15T00:00:00.000Z">Feb 15, 2021</time></small><h2 id="named-tuple" attrs="[object Object]">Named tuple</h2><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">from</span><span> typing </span><span class="token token" style="color:#cc99cd">import</span><span> NamedTuple
</span>
<span></span><span class="token token" style="color:#cc99cd">class</span><span> </span><span class="token token" style="color:#f8c555">EnvParams</span><span class="token token" style="color:#ccc">(</span><span>NamedTuple</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    name</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span>
</span><span>    nr_agents</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">int</span><span>
</span><span>    mode</span><span class="token token" style="color:#ccc">:</span><span> Literal</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;uniform&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;relative&quot;</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;uniform&quot;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">get_params</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#67cdcc">&gt;</span><span> EnvParams</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> EnvParams</span><span class="token token" style="color:#ccc">(</span><span>name</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;hello&quot;</span><span class="token token" style="color:#ccc">,</span><span> nr_agents</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">42</span><span class="token token" style="color:#ccc">)</span></code></pre><ul><li>automatic constructor generation etc</li><li>strong typing</li><li>immutable</li><li>same memory usage as normal tuples</li><li>default values</li><li>more safety than tuples, access <code attrs="[object Object]">params.name</code> like objects, order does not matter</li><li>compatible API with tuples</li></ul><h2 id="typing" attrs="[object Object]">Typing</h2><p>A must if you’re used to typed programming languages. Makes it much easier to read and understand code, as well as fixing a whole class of bugs.</p><p>Let’s say you have some simple code to print a list of words:</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">show_words</span><span class="token token" style="color:#ccc">(</span><span>list_of_words</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">for</span><span> i</span><span class="token token" style="color:#ccc">,</span><span> word </span><span class="token token" style="color:#cc99cd">in</span><span> </span><span class="token token" style="color:#cc99cd">enumerate</span><span class="token token" style="color:#ccc">(</span><span>list_of_words</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">print</span><span class="token token" style="color:#ccc">(</span><span class="token token string-interpolation" style="color:#7ec699">f&quot;word </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">i</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">: </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">word</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">&quot;</span><span class="token token" style="color:#ccc">)</span></code></pre><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#67cdcc">&gt;</span><span> show_words</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;hello&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;hi&quot;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>word </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">:</span><span> hello
</span><span>word </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">:</span><span> hi</span></code></pre><p>Easy enough, right?</p><p>But what happens if that code is accidentally called with a string?</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>show_words</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;hello&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>word </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">:</span><span> h
</span><span>word </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">:</span><span> e
</span><span>word </span><span class="token token" style="color:#f08d49">2</span><span class="token token" style="color:#ccc">:</span><span> l
</span><span>word </span><span class="token token" style="color:#f08d49">3</span><span class="token token" style="color:#ccc">:</span><span> l
</span><span>word </span><span class="token token" style="color:#f08d49">4</span><span class="token token" style="color:#ccc">:</span><span> o</span></code></pre><p>Since iterating works for strings as well, the code works - but not as expected. In this example the issue is easy to find, but if for example you have a multidimensional list where each text is processed in some way and passed further along into a neural network, you might not find this issue for a very long time.</p><p>It’s even worse because in python, chars are strings as well (e.g. <code attrs="[object Object]">&quot;a&quot;[0][0][0] == &quot;a&quot;</code>), so you can have a nested loop of any depth that will still work when receiving a string.</p><p>The solution is simple:</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">show_lists</span><span class="token token" style="color:#ccc">(</span><span>words</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">list</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#f08d49">None</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#999"># if you try to call this function with anything</span><span>
</span><span>    </span><span class="token token" style="color:#999"># that&#x27;s *not* a list of strings, your IDE (and mypy)</span><span>
</span><span>    </span><span class="token token" style="color:#999"># will throw an error.</span></code></pre><h2 id="f-strings" attrs="[object Object]">F-strings</h2><p>There’s many ways to format strings in python, with the original one being <a href="https://stackabuse.com/python-string-interpolation-with-the-percent-operator/" attrs="[object Object]"><code attrs="[object Object]">%</code> formatting</a>. But the best way since Python 3.7 is literal f-strings:</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">fn</span><span class="token token" style="color:#ccc">(</span><span>x</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">return</span><span> x </span><span class="token token" style="color:#67cdcc">*</span><span> x
</span>
<span>x </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">5</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">print</span><span class="token token" style="color:#ccc">(</span><span class="token token string-interpolation" style="color:#7ec699">f&quot;for input </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">x</span><span class="token token string-interpolation interpolation" style="color:#ccc">:</span><span class="token token string-interpolation interpolation format-spec">.1f</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">, </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">fn</span><span class="token token string-interpolation interpolation" style="color:#ccc">(</span><span class="token token string-interpolation interpolation">x</span><span class="token token string-interpolation interpolation" style="color:#ccc">)</span><span class="token token string-interpolation interpolation" style="color:#67cdcc">=</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">&quot;</span><span class="token token" style="color:#ccc">)</span></code></pre><p>Prints: <code attrs="[object Object]">for input 5.0, fn(x)=25</code></p><p>Similar to <code attrs="[object Object]">&quot;x is {x}&quot;.format(x=x)</code> but easier to read and write. You can add simple expression inside the {}. The special format specifier <code attrs="[object Object]">f&quot;{foo=}&quot;</code> is the same as doing <code attrs="[object Object]">f&quot;foo={foo}&quot;</code></p><h2 id="pathlib" attrs="[object Object]">Pathlib</h2><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">from</span><span> pathlib </span><span class="token token" style="color:#cc99cd">import</span><span> Path
</span>
<span>mydir </span><span class="token token" style="color:#67cdcc">=</span><span> Path</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;foo&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>myfile </span><span class="token token" style="color:#67cdcc">=</span><span> mydir </span><span class="token token" style="color:#67cdcc">/</span><span> </span><span class="token token" style="color:#7ec699">&quot;filename.txt&quot;</span></code></pre><p>If you pass file paths around as strings, you have to figure out when to add slashes and when not to, and unless you always use <code attrs="[object Object]">os.path.sep</code> your code will work differently depending on the OS. With pathlib, you can join paths using just the <code attrs="[object Object]">/</code> operator, regardless of the OS of the user.</p><p><code attrs="[object Object]">Path</code>s have great methods for manipulating filenames that are much more readable than their <code attrs="[object Object]">os.path</code> equivalents:</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>myfile </span><span class="token token" style="color:#67cdcc">=</span><span> Path</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;foo/filename.txt&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>myfile</span><span class="token token" style="color:#ccc">.</span><span>parent </span><span class="token token" style="color:#999"># Path(&quot;foo&quot;)</span><span>
</span><span>myfile</span><span class="token token" style="color:#ccc">.</span><span>name </span><span class="token token" style="color:#999"># &quot;filename.txt&quot;</span><span>
</span><span>myfile</span><span class="token token" style="color:#ccc">.</span><span>suffix </span><span class="token token" style="color:#999"># &quot;.txt&quot;</span><span>
</span><span></span><span class="token token" style="color:#999"># replace file extension</span><span>
</span><span>myfile</span><span class="token token" style="color:#ccc">.</span><span>with_suffix</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;.csv&#x27;</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#999"># foo/filename.csv</span></code></pre><p><code attrs="[object Object]">Path</code>s also have neat methods for opening / reading / writing files:</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>myfile</span><span class="token token" style="color:#ccc">.</span><span>write_text</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;hello&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">if</span><span> myfile</span><span class="token token" style="color:#ccc">.</span><span>exists</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">with</span><span> myfile</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">open</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;r&quot;</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> f</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#999"># ...</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">pass</span><span>
</span>
<span>text </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span>mydir </span><span class="token token" style="color:#67cdcc">/</span><span> </span><span class="token token" style="color:#7ec699">&quot;input.txt&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>read_text</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token" style="color:#cc99cd">for</span><span> </span><span class="token token" style="color:#cc99cd">file</span><span> </span><span class="token token" style="color:#cc99cd">in</span><span> Path</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;foo&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>glob</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;*.txt&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>  </span><span class="token token" style="color:#999"># every txt file in foo/</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">pass</span></code></pre><h2 id="relative-imports" attrs="[object Object]">Relative imports</h2><p>The following is fairly common python code:</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>import util
</span>
<!-- -->util.foo()
</code></pre><p>But what is <code attrs="[object Object]">util</code>? It can be either a global module or a local file / directory. If there is a local file named <code attrs="[object Object]">util.py</code>, it will shadow the corresponding module. This is a pretty common issue, and happens even to <a href="https://github.com/pytorch/pytorch/issues/24807#issuecomment-524155619" attrs="[object Object]">experienced devs</a>.</p><p>Instead, in my opinion you should always use relative imports if you want to import a relative module instead of global ones.</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#ccc">.</span><span> </span><span class="token token" style="color:#cc99cd">import</span><span> util
</span><span></span><span class="token token" style="color:#999"># or</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#ccc">.</span><span>util </span><span class="token token" style="color:#cc99cd">import</span><span> foo</span></code></pre><p>Sadly this ambiguity issue is not completely fixeable without a breaking change in python itself, and due to a bad design decision in the Python module system relative imports have <a href="https://stackoverflow.com/a/28154841/2639190" attrs="[object Object]">some issues when python files are loaded in a specific way called <span class="quoted">&quot;<!-- -->script mode<!-- -->&quot;</span></a>, which you will probably come across sooner or later.</p><h2 id="ordered-unordered-dicts" attrs="[object Object]">Ordered unordered dicts</h2><p>Since Python 3.6, Python uses a more compact representation of dicts (and thus <code attrs="[object Object]">kwargs</code>). Since Python 3.7, it is guaranteed that dicts are always iterated over in insertion order.</p><p>This means that every dict is basically an <code attrs="[object Object]">OrderedDict</code> except some utility functions are missing. This is really useful, because it means you can use normal dicts as ordered associative arrays.</p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>x </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#7ec699">&quot;c&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f08d49">True</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  </span><span class="token token" style="color:#7ec699">&quot;b&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f08d49">False</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  </span><span class="token token" style="color:#7ec699">&quot;d&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f08d49">False</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> key </span><span class="token token" style="color:#cc99cd">in</span><span> x</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#999"># guaranteed to always go through keys in the order &quot;c&quot;, &quot;b&quot;, &quot;d&quot;!</span></code></pre><h2 id="multiprocessing" attrs="[object Object]">Multiprocessing</h2><p>There’s a ton of libraries for multithreading / multiprocessing in python, with varying degrees of magicness. But in Python 3, there’s actually an integrated way to run a function on a large set of data quickly: <a href="https://docs.python.org/3/library/multiprocessing.html" attrs="[object Object]"><code attrs="[object Object]">multiprocessing.Pool</code></a></p><pre class="py" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">f</span><span class="token token" style="color:#ccc">(</span><span>x</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#999"># expensive computation</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> x </span><span class="token token" style="color:#67cdcc">*</span><span> x
</span>
<span></span><span class="token token" style="color:#cc99cd">from</span><span> multiprocessing </span><span class="token token" style="color:#cc99cd">import</span><span> Pool
</span>
<span></span><span class="token token" style="color:#cc99cd">with</span><span> Pool</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> p</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">for</span><span> result </span><span class="token token" style="color:#cc99cd">in</span><span> p</span><span class="token token" style="color:#ccc">.</span><span>imap</span><span class="token token" style="color:#ccc">(</span><span>f</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">2</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">3</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">,</span><span> chunksize</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>      </span><span class="token token" style="color:#999"># ... handle result</span></code></pre><p>This code does the same as <code attrs="[object Object]">for i in [1,2,3]: f(i)</code> except using all your CPU cores.</p><h2 id="typed-argparse" attrs="[object Object]">Typed Argparse</h2><p><a href="https://docs.python.org/3/library/argparse.html" attrs="[object Object]">Argparse</a> is a neat library to create a simple command line interface. But arguments are declared as strings, and the IDE can’t know about them.</p><p>With <a href="https://github.com/swansonk14/typed-argument-parser" attrs="[object Object]">Typed-Argparse</a>, your arguments are parsed directly into a class instance! It’s a separate library, not integrated in python like argparse, but it’s much neater.</p><p><img src="https://raw.githubusercontent.com/swansonk14/typed-argument-parser/master/images/tap.png" title="fig:" attrs="[object Object]"/></p><h2 id="poetry" attrs="[object Object]">Poetry</h2><p>Here is all the stages of a Python developer’s slow decent into madness:</p><ol start="1" type="1"><li><p>You write single file .py scripts without imports and functions. It’s so easy to get so much done! You feel enlightened.</p></li><li><p>You start splitting your code in multiple functions in .py files, and feel enlightened of how structured your code is now.</p></li><li><p>You need to do some maths, so you learn about <code attrs="[object Object]">pip</code> and run <code attrs="[object Object]">pip install numpy</code> globally. You feel enlightened about how easy it is to use libraries. It’s as easy as <a href="https://xkcd.com/353/" attrs="[object Object]">import antigravity</a>!</p></li><li><p>At some point you have some multiple projects that need different versions of some libraries. You learn about virtualenvs. You are confused about the difference between <code attrs="[object Object]">venv</code>, <code attrs="[object Object]">virtualenv</code>, <code attrs="[object Object]">virtualenvwrapper</code>, but some random memorized commands works so you start using virtualenvs.</p></li><li><p>You try to use some older library from GitHub. You learn about <code attrs="[object Object]">setup.py</code> files and <code attrs="[object Object]">requirements.txt</code> files, and you feel enlightened! This is how you define exactly what you need to run your program! The project you’re trying to use has a requirements.txt file like this:</p><pre style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>pandas
</span>numpy
</code></pre><p>So you eagerly run</p><pre class="sh" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sh" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>python -m venv .venv
</span>source .venv/bin/activate
<!-- -->pip install -r requirements.txt
</code></pre><p>Then you try running the project, but it turns out it actually also needs <code attrs="[object Object]">sklearn</code>. So you try <code attrs="[object Object]">pip install sklearn</code> only to realize that <code attrs="[object Object]">sklearn</code> is actually a random package from someone else and to get <code attrs="[object Object]">sklearn</code> you actually need to install <code attrs="[object Object]">scikit-learn</code>. You realize that package names are not actually related to the names of python modules (except incidentally) and feel enlightened by the power!</p><p>But the code still doesn’t run, theer’s some weird issue. After an hour of investigation, you find some obscure bug <a href="http://blog.khinsen.net/posts/2017/11/16/a-plea-for-stability-in-the-scipy-ecosystem/" attrs="[object Object]">caused by an incompatible change</a> some time 5 years ago in numpy. You try some old numpy versions until you find one that works. You learn about <a href="https://devhints.io/semver" attrs="[object Object]">semver</a> and <a href="https://tech.instacart.com/freezing-pythons-dependency-hell-in-2018-f1076d625241" attrs="[object Object]">freezing</a>, and you feel enlightened! The developer should have just put <code attrs="[object Object]">numpy==1.10</code> into their requirements.txt!</p></li><li><p>You find <a href="https://pytorch.org/get-started/locally/" attrs="[object Object]">something that recommends using Conda</a>. You are somewhat confused why the conda download is taking so long and eating up 2GB of bandwidth. After accepting a random EULA and having your shell changed prompt always say <code attrs="[object Object]">(base) $</code>, you realize that in conda, everything is an env! It’s so quick to add libraries, <a href="https://anaconda.org/anaconda/mkl" attrs="[object Object]">even weird native ones</a> ! You feel enlightened.</p></li><li><p>You read some documentation and call a python function, but the function does not exist. After some reading, you see that the package you installed via conda is an outdated version. You now understand that conda is a completely different package manager from pip, and that conda packages are actually managed by third parties, some of which are outdated, and many don’t exist at all. You start using <code attrs="[object Object]">pip</code> for some things and <code attrs="[object Object]">conda</code> for other things, all in the same environment. Sometimes you randomly add <code attrs="[object Object]">-c conda-forge</code> when conda install doesn’t work.</p></li><li><p>The find out about the Official Modern Python Packaging tool <a href="https://pipenv.pypa.io/en/latest/" attrs="[object Object]">pipenv</a>! Pipenv always and automatically manages a virtualenv with the exact dependencies as defined in a <code attrs="[object Object]">Pipfile</code>, which is like a supercharged <code attrs="[object Object]">requirements.txt</code>. It’s amazing! Except you soon try to install a package and get a <code attrs="[object Object]">Could not resolve dependencies</code> error. You google a while, and figure out that most pypi packages don’t actually have correctly specified dependencies, and that pip just doesn’t really care about that. You also find out that <a href="https://chriswarrick.com/blog/2018/07/17/pipenv-promises-a-lot-delivers-very-little/" attrs="[object Object]">pipenv only really pretended to be an official tool</a>.</p></li><li><p>You find out about <a href="https://python-poetry.org/" attrs="[object Object]">poetry</a>. It’s like pipenv but actually fairly good! It only takes 2 minutes to resolve dependencies instead of 10! It even puts your virtualenv in <code attrs="[object Object]">~/.cache</code> because it <em>really</em> doesn’t matter if it gets deleted!</p></li><li><p>A while later you find the latest development of python dependency management: <a href="https://github.com/David-OConnor/pyflow#why-add-another-python-manager" attrs="[object Object]">pyflow</a> and <a href="https://github.com/pdm-project/pdm" attrs="[object Object]">pdm</a>. It uses the same standard <code attrs="[object Object]">pyproject.toml</code> format as poetry, but it puts your dependencies in a <code attrs="[object Object]">./__pypackages__</code> directory so when running stuff you don’t have to care about activating a virtualenv or always using <code attrs="[object Object]">poetry run python</code>. … Wait, isn’t that literally just <a href="https://www.reddit.com/r/ProgrammerHumor/comments/6s0wov/heaviest_objects_in_the_universe/" attrs="[object Object]">node_modules</a>? The thing JS devs have been complaining about for a decade?</p></li></ol><p>Tl;dr:</p><p><img src="https://imgs.xkcd.com/comics/python_environment.png" title="fig:" attrs="[object Object]"/></p></div><footer class="center w5 f6 tc mt4"><p><a href="https://github.com/phiresky/blog/blob/master/posts/2021/python-features.md">View post source on GitHub</a></p></footer><div><script>/* yes, I know... fite me */
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
  function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='https://www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-39197996-3','auto');ga('send','pageview');
</script></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"filename":"2021/python-features.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2021-02-15","hidden":true,"references":[],"subtitle":"","title":"10 underused features of modern Python [incomplete]","url2cite-link-output":"sup"},"preview":"Named tupleautomatic constructor generation etcstrong typingimmutablesame memory usage as normal tuplesdefault valuesmore safety than tuples, access params.name like objects, order does not mattercompatible API with tuplesTyping A must if you’re used to typed programming languages. Makes it much","content_ast":[{"t":"Header","c":[2,["named-tuple",[],[]],[{"t":"Str","c":"Named tuple"}]]},{"t":"CodeBlock","c":[["",["py"],[]],"from typing import NamedTuple\n\nclass EnvParams(NamedTuple):\n    name: str\n    nr_agents: int\n    mode: Literal[\"uniform\", \"relative\"] = \"uniform\"\n\ndef get_params() -\u003e EnvParams:\n    return EnvParams(name=\"hello\", nr_agents=42)"]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"automatic constructor generation etc"}]}],[{"t":"Plain","c":[{"t":"Str","c":"strong typing"}]}],[{"t":"Plain","c":[{"t":"Str","c":"immutable"}]}],[{"t":"Plain","c":[{"t":"Str","c":"same memory usage as normal tuples"}]}],[{"t":"Plain","c":[{"t":"Str","c":"default values"}]}],[{"t":"Plain","c":[{"t":"Str","c":"more safety than tuples, access "},{"t":"Code","c":[["",[],[]],"params.name"]},{"t":"Str","c":" like objects, order does not matter"}]}],[{"t":"Plain","c":[{"t":"Str","c":"compatible API with tuples"}]}]]},{"t":"Header","c":[2,["typing",[],[]],[{"t":"Str","c":"Typing"}]]},{"t":"Para","c":[{"t":"Str","c":"A must if you’re used to typed programming languages. Makes it much easier to read and understand code, as well as fixing a whole class of bugs."}]},{"t":"Para","c":[{"t":"Str","c":"Let’s say you have some simple code to print a list of words:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"def show_words(list_of_words):\n    for i, word in enumerate(list_of_words):\n        print(f\"word {i}: {word}\")"]},{"t":"CodeBlock","c":[["",["py"],[]],"\u003e show_words([\"hello\", \"hi\"])\n\nword 0: hello\nword 1: hi"]},{"t":"Para","c":[{"t":"Str","c":"Easy enough, right?"}]},{"t":"Para","c":[{"t":"Str","c":"But what happens if that code is accidentally called with a string?"}]},{"t":"CodeBlock","c":[["",["py"],[]],"show_words(\"hello\")\nword 0: h\nword 1: e\nword 2: l\nword 3: l\nword 4: o"]},{"t":"Para","c":[{"t":"Str","c":"Since iterating works for strings as well, the code works - but not as expected. In this example the issue is easy to find, but if for example you have a multidimensional list where each text is processed in some way and passed further along into a neural network, you might not find this issue for a very long time."}]},{"t":"Para","c":[{"t":"Str","c":"It’s even worse because in python, chars are strings as well (e.g. "},{"t":"Code","c":[["",[],[]],"\"a\"[0][0][0] == \"a\""]},{"t":"Str","c":"), so you can have a nested loop of any depth that will still work when receiving a string."}]},{"t":"Para","c":[{"t":"Str","c":"The solution is simple:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"def show_lists(words: list[str]) -\u003e None:\n    # if you try to call this function with anything\n    # that's *not* a list of strings, your IDE (and mypy)\n    # will throw an error."]},{"t":"Header","c":[2,["f-strings",[],[]],[{"t":"Str","c":"F-strings"}]]},{"t":"Para","c":[{"t":"Str","c":"There’s many ways to format strings in python, with the original one being "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"%"]},{"t":"Str","c":" formatting"}],["https://stackabuse.com/python-string-interpolation-with-the-percent-operator/",""]]},{"t":"Str","c":". But the best way since Python 3.7 is literal f-strings:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"def fn(x):\n  return x * x\n\nx = 5\nprint(f\"for input {x:.1f}, {fn(x)=}\")"]},{"t":"Para","c":[{"t":"Str","c":"Prints: "},{"t":"Code","c":[["",[],[]],"for input 5.0, fn(x)=25"]}]},{"t":"Para","c":[{"t":"Str","c":"Similar to "},{"t":"Code","c":[["",[],[]],"\"x is {x}\".format(x=x)"]},{"t":"Str","c":" but easier to read and write. You can add simple expression inside the {}. The special format specifier "},{"t":"Code","c":[["",[],[]],"f\"{foo=}\""]},{"t":"Str","c":" is the same as doing "},{"t":"Code","c":[["",[],[]],"f\"foo={foo}\""]}]},{"t":"Header","c":[2,["pathlib",[],[]],[{"t":"Str","c":"Pathlib"}]]},{"t":"CodeBlock","c":[["",["py"],[]],"from pathlib import Path\n\nmydir = Path(\"foo\")\n\nmyfile = mydir / \"filename.txt\""]},{"t":"Para","c":[{"t":"Str","c":"If you pass file paths around as strings, you have to figure out when to add slashes and when not to, and unless you always use "},{"t":"Code","c":[["",[],[]],"os.path.sep"]},{"t":"Str","c":" your code will work differently depending on the OS. With pathlib, you can join paths using just the "},{"t":"Code","c":[["",[],[]],"/"]},{"t":"Str","c":" operator, regardless of the OS of the user."}]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"Path"]},{"t":"Str","c":"s have great methods for manipulating filenames that are much more readable than their "},{"t":"Code","c":[["",[],[]],"os.path"]},{"t":"Str","c":" equivalents:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"myfile = Path(\"foo/filename.txt\")\nmyfile.parent # Path(\"foo\")\nmyfile.name # \"filename.txt\"\nmyfile.suffix # \".txt\"\n# replace file extension\nmyfile.with_suffix('.csv') # foo/filename.csv"]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"Path"]},{"t":"Str","c":"s also have neat methods for opening / reading / writing files:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"myfile.write_text(\"hello\")\n\nif myfile.exists():\n  with myfile.open(\"r\") as f:\n    # ...\n    pass\n\ntext = (mydir / \"input.txt\").read_text()\n\n\nfor file in Path(\"foo\").glob(\"*.txt\"):\n  # every txt file in foo/\n  pass"]},{"t":"Header","c":[2,["relative-imports",[],[]],[{"t":"Str","c":"Relative imports"}]]},{"t":"Para","c":[{"t":"Str","c":"The following is fairly common python code:"}]},{"t":"CodeBlock","c":[["",[],[]],"import util\n\nutil.foo()"]},{"t":"Para","c":[{"t":"Str","c":"But what is "},{"t":"Code","c":[["",[],[]],"util"]},{"t":"Str","c":"? It can be either a global module or a local file / directory. If there is a local file named "},{"t":"Code","c":[["",[],[]],"util.py"]},{"t":"Str","c":", it will shadow the corresponding module. This is a pretty common issue, and happens even to "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"experienced devs"}],["https://github.com/pytorch/pytorch/issues/24807#issuecomment-524155619",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"Instead, in my opinion you should always use relative imports if you want to import a relative module instead of global ones."}]},{"t":"CodeBlock","c":[["",["py"],[]],"from . import util\n# or\nfrom .util import foo"]},{"t":"Para","c":[{"t":"Str","c":"Sadly this ambiguity issue is not completely fixeable without a breaking change in python itself, and due to a bad design decision in the Python module system relative imports have "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"some issues when python files are loaded in a specific way called "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"script mode"}]]}],["https://stackoverflow.com/a/28154841/2639190",""]]},{"t":"Str","c":", which you will probably come across sooner or later."}]},{"t":"Header","c":[2,["ordered-unordered-dicts",[],[]],[{"t":"Str","c":"Ordered unordered dicts"}]]},{"t":"Para","c":[{"t":"Str","c":"Since Python 3.6, Python uses a more compact representation of dicts (and thus "},{"t":"Code","c":[["",[],[]],"kwargs"]},{"t":"Str","c":"). Since Python 3.7, it is guaranteed that dicts are always iterated over in insertion order."}]},{"t":"Para","c":[{"t":"Str","c":"This means that every dict is basically an "},{"t":"Code","c":[["",[],[]],"OrderedDict"]},{"t":"Str","c":" except some utility functions are missing. This is really useful, because it means you can use normal dicts as ordered associative arrays."}]},{"t":"CodeBlock","c":[["",["py"],[]],"x = {\n  \"c\": True,\n  \"b\": False,\n  \"d\": False\n}\nfor key in x:\n    # guaranteed to always go through keys in the order \"c\", \"b\", \"d\"!"]},{"t":"Header","c":[2,["multiprocessing",[],[]],[{"t":"Str","c":"Multiprocessing"}]]},{"t":"Para","c":[{"t":"Str","c":"There’s a ton of libraries for multithreading / multiprocessing in python, with varying degrees of magicness. But in Python 3, there’s actually an integrated way to run a function on a large set of data quickly: "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"multiprocessing.Pool"]}],["https://docs.python.org/3/library/multiprocessing.html",""]]}]},{"t":"CodeBlock","c":[["",["py"],[]],"def f(x):\n    # expensive computation\n    return x * x\n\nfrom multiprocessing import Pool\n\nwith Pool() as p:\n    for result in p.imap(f, [1, 2, 3], chunksize=100):\n      # ... handle result"]},{"t":"Para","c":[{"t":"Str","c":"This code does the same as "},{"t":"Code","c":[["",[],[]],"for i in [1,2,3]: f(i)"]},{"t":"Str","c":" except using all your CPU cores."}]},{"t":"Header","c":[2,["typed-argparse",[],[]],[{"t":"Str","c":"Typed Argparse"}]]},{"t":"Para","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Argparse"}],["https://docs.python.org/3/library/argparse.html",""]]},{"t":"Str","c":" is a neat library to create a simple command line interface. But arguments are declared as strings, and the IDE can’t know about them."}]},{"t":"Para","c":[{"t":"Str","c":"With "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Typed-Argparse"}],["https://github.com/swansonk14/typed-argument-parser",""]]},{"t":"Str","c":", your arguments are parsed directly into a class instance! It’s a separate library, not integrated in python like argparse, but it’s much neater."}]},{"t":"Para","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"TAP example"}],["https://raw.githubusercontent.com/swansonk14/typed-argument-parser/master/images/tap.png","fig:"]]}]},{"t":"Header","c":[2,["poetry",[],[]],[{"t":"Str","c":"Poetry"}]]},{"t":"Para","c":[{"t":"Str","c":"Here is all the stages of a Python developer’s slow decent into madness:"}]},{"t":"OrderedList","c":[[1,{"t":"Decimal"},{"t":"Period"}],[[{"t":"Para","c":[{"t":"Str","c":"You write single file .py scripts without imports and functions. It’s so easy to get so much done! You feel enlightened."}]}],[{"t":"Para","c":[{"t":"Str","c":"You start splitting your code in multiple functions in .py files, and feel enlightened of how structured your code is now."}]}],[{"t":"Para","c":[{"t":"Str","c":"You need to do some maths, so you learn about "},{"t":"Code","c":[["",[],[]],"pip"]},{"t":"Str","c":" and run "},{"t":"Code","c":[["",[],[]],"pip install numpy"]},{"t":"Str","c":" globally. You feel enlightened about how easy it is to use libraries. It’s as easy as "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"import antigravity"}],["https://xkcd.com/353/",""]]},{"t":"Str","c":"!"}]}],[{"t":"Para","c":[{"t":"Str","c":"At some point you have some multiple projects that need different versions of some libraries. You learn about virtualenvs. You are confused about the difference between "},{"t":"Code","c":[["",[],[]],"venv"]},{"t":"Str","c":", "},{"t":"Code","c":[["",[],[]],"virtualenv"]},{"t":"Str","c":", "},{"t":"Code","c":[["",[],[]],"virtualenvwrapper"]},{"t":"Str","c":", but some random memorized commands works so you start using virtualenvs."}]}],[{"t":"Para","c":[{"t":"Str","c":"You try to use some older library from GitHub. You learn about "},{"t":"Code","c":[["",[],[]],"setup.py"]},{"t":"Str","c":" files and "},{"t":"Code","c":[["",[],[]],"requirements.txt"]},{"t":"Str","c":" files, and you feel enlightened! This is how you define exactly what you need to run your program! The project you’re trying to use has a requirements.txt file like this:"}]},{"t":"CodeBlock","c":[["",[],[]],"pandas\nnumpy"]},{"t":"Para","c":[{"t":"Str","c":"So you eagerly run"}]},{"t":"CodeBlock","c":[["",["sh"],[]],"python -m venv .venv\nsource .venv/bin/activate\npip install -r requirements.txt"]},{"t":"Para","c":[{"t":"Str","c":"Then you try running the project, but it turns out it actually also needs "},{"t":"Code","c":[["",[],[]],"sklearn"]},{"t":"Str","c":". So you try "},{"t":"Code","c":[["",[],[]],"pip install sklearn"]},{"t":"Str","c":" only to realize that "},{"t":"Code","c":[["",[],[]],"sklearn"]},{"t":"Str","c":" is actually a random package from someone else and to get "},{"t":"Code","c":[["",[],[]],"sklearn"]},{"t":"Str","c":" you actually need to install "},{"t":"Code","c":[["",[],[]],"scikit-learn"]},{"t":"Str","c":". You realize that package names are not actually related to the names of python modules (except incidentally) and feel enlightened by the power!"}]},{"t":"Para","c":[{"t":"Str","c":"But the code still doesn’t run, theer’s some weird issue. After an hour of investigation, you find some obscure bug "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"caused by an incompatible change"}],["http://blog.khinsen.net/posts/2017/11/16/a-plea-for-stability-in-the-scipy-ecosystem/",""]]},{"t":"Str","c":" some time 5 years ago in numpy. You try some old numpy versions until you find one that works. You learn about "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"semver"}],["https://devhints.io/semver",""]]},{"t":"Str","c":" and "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"freezing"}],["https://tech.instacart.com/freezing-pythons-dependency-hell-in-2018-f1076d625241",""]]},{"t":"Str","c":", and you feel enlightened! The developer should have just put "},{"t":"Code","c":[["",[],[]],"numpy==1.10"]},{"t":"Str","c":" into their requirements.txt!"}]}],[{"t":"Para","c":[{"t":"Str","c":"You find "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"something that recommends using Conda"}],["https://pytorch.org/get-started/locally/",""]]},{"t":"Str","c":". You are somewhat confused why the conda download is taking so long and eating up 2GB of bandwidth. After accepting a random EULA and having your shell changed prompt always say "},{"t":"Code","c":[["",[],[]],"(base) $"]},{"t":"Str","c":", you realize that in conda, everything is an env! It’s so quick to add libraries, "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"even weird native ones"}],["https://anaconda.org/anaconda/mkl",""]]},{"t":"Str","c":" ! You feel enlightened."}]}],[{"t":"Para","c":[{"t":"Str","c":"You read some documentation and call a python function, but the function does not exist. After some reading, you see that the package you installed via conda is an outdated version. You now understand that conda is a completely different package manager from pip, and that conda packages are actually managed by third parties, some of which are outdated, and many don’t exist at all. You start using "},{"t":"Code","c":[["",[],[]],"pip"]},{"t":"Str","c":" for some things and "},{"t":"Code","c":[["",[],[]],"conda"]},{"t":"Str","c":" for other things, all in the same environment. Sometimes you randomly add "},{"t":"Code","c":[["",[],[]],"-c conda-forge"]},{"t":"Str","c":" when conda install doesn’t work."}]}],[{"t":"Para","c":[{"t":"Str","c":"The find out about the Official Modern Python Packaging tool "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pipenv"}],["https://pipenv.pypa.io/en/latest/",""]]},{"t":"Str","c":"! Pipenv always and automatically manages a virtualenv with the exact dependencies as defined in a "},{"t":"Code","c":[["",[],[]],"Pipfile"]},{"t":"Str","c":", which is like a supercharged "},{"t":"Code","c":[["",[],[]],"requirements.txt"]},{"t":"Str","c":". It’s amazing! Except you soon try to install a package and get a "},{"t":"Code","c":[["",[],[]],"Could not resolve dependencies"]},{"t":"Str","c":" error. You google a while, and figure out that most pypi packages don’t actually have correctly specified dependencies, and that pip just doesn’t really care about that. You also find out that "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pipenv only really pretended to be an official tool"}],["https://chriswarrick.com/blog/2018/07/17/pipenv-promises-a-lot-delivers-very-little/",""]]},{"t":"Str","c":"."}]}],[{"t":"Para","c":[{"t":"Str","c":"You find out about "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"poetry"}],["https://python-poetry.org/",""]]},{"t":"Str","c":". It’s like pipenv but actually fairly good! It only takes 2 minutes to resolve dependencies instead of 10! It even puts your virtualenv in "},{"t":"Code","c":[["",[],[]],"~/.cache"]},{"t":"Str","c":" because it "},{"t":"Emph","c":[{"t":"Str","c":"really"}]},{"t":"Str","c":" doesn’t matter if it gets deleted!"}]}],[{"t":"Para","c":[{"t":"Str","c":"A while later you find the latest development of python dependency management: "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pyflow"}],["https://github.com/David-OConnor/pyflow#why-add-another-python-manager",""]]},{"t":"Str","c":" and "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pdm"}],["https://github.com/pdm-project/pdm",""]]},{"t":"Str","c":". It uses the same standard "},{"t":"Code","c":[["",[],[]],"pyproject.toml"]},{"t":"Str","c":" format as poetry, but it puts your dependencies in a "},{"t":"Code","c":[["",[],[]],"./__pypackages__"]},{"t":"Str","c":" directory so when running stuff you don’t have to care about activating a virtualenv or always using "},{"t":"Code","c":[["",[],[]],"poetry run python"]},{"t":"Str","c":". … Wait, isn’t that literally just "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"node_modules"}],["https://www.reddit.com/r/ProgrammerHumor/comments/6s0wov/heaviest_objects_in_the_universe/",""]]},{"t":"Str","c":"? The thing JS devs have been complaining about for a decade?"}]}]]]},{"t":"Para","c":[{"t":"Str","c":"Tl;dr:"}]},{"t":"Para","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"xkcd"}],["https://imgs.xkcd.com/comics/python_environment.png","fig:"]]}]}],"default":{"filename":"2021/python-features.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2021-02-15","hidden":true,"references":[],"subtitle":"","title":"10 underused features of modern Python [incomplete]","url2cite-link-output":"sup"},"preview":"Named tupleautomatic constructor generation etcstrong typingimmutablesame memory usage as normal tuplesdefault valuesmore safety than tuples, access params.name like objects, order does not mattercompatible API with tuplesTyping A must if you’re used to typed programming languages. Makes it much","content_ast":[{"t":"Header","c":[2,["named-tuple",[],[]],[{"t":"Str","c":"Named tuple"}]]},{"t":"CodeBlock","c":[["",["py"],[]],"from typing import NamedTuple\n\nclass EnvParams(NamedTuple):\n    name: str\n    nr_agents: int\n    mode: Literal[\"uniform\", \"relative\"] = \"uniform\"\n\ndef get_params() -\u003e EnvParams:\n    return EnvParams(name=\"hello\", nr_agents=42)"]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"automatic constructor generation etc"}]}],[{"t":"Plain","c":[{"t":"Str","c":"strong typing"}]}],[{"t":"Plain","c":[{"t":"Str","c":"immutable"}]}],[{"t":"Plain","c":[{"t":"Str","c":"same memory usage as normal tuples"}]}],[{"t":"Plain","c":[{"t":"Str","c":"default values"}]}],[{"t":"Plain","c":[{"t":"Str","c":"more safety than tuples, access "},{"t":"Code","c":[["",[],[]],"params.name"]},{"t":"Str","c":" like objects, order does not matter"}]}],[{"t":"Plain","c":[{"t":"Str","c":"compatible API with tuples"}]}]]},{"t":"Header","c":[2,["typing",[],[]],[{"t":"Str","c":"Typing"}]]},{"t":"Para","c":[{"t":"Str","c":"A must if you’re used to typed programming languages. Makes it much easier to read and understand code, as well as fixing a whole class of bugs."}]},{"t":"Para","c":[{"t":"Str","c":"Let’s say you have some simple code to print a list of words:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"def show_words(list_of_words):\n    for i, word in enumerate(list_of_words):\n        print(f\"word {i}: {word}\")"]},{"t":"CodeBlock","c":[["",["py"],[]],"\u003e show_words([\"hello\", \"hi\"])\n\nword 0: hello\nword 1: hi"]},{"t":"Para","c":[{"t":"Str","c":"Easy enough, right?"}]},{"t":"Para","c":[{"t":"Str","c":"But what happens if that code is accidentally called with a string?"}]},{"t":"CodeBlock","c":[["",["py"],[]],"show_words(\"hello\")\nword 0: h\nword 1: e\nword 2: l\nword 3: l\nword 4: o"]},{"t":"Para","c":[{"t":"Str","c":"Since iterating works for strings as well, the code works - but not as expected. In this example the issue is easy to find, but if for example you have a multidimensional list where each text is processed in some way and passed further along into a neural network, you might not find this issue for a very long time."}]},{"t":"Para","c":[{"t":"Str","c":"It’s even worse because in python, chars are strings as well (e.g. "},{"t":"Code","c":[["",[],[]],"\"a\"[0][0][0] == \"a\""]},{"t":"Str","c":"), so you can have a nested loop of any depth that will still work when receiving a string."}]},{"t":"Para","c":[{"t":"Str","c":"The solution is simple:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"def show_lists(words: list[str]) -\u003e None:\n    # if you try to call this function with anything\n    # that's *not* a list of strings, your IDE (and mypy)\n    # will throw an error."]},{"t":"Header","c":[2,["f-strings",[],[]],[{"t":"Str","c":"F-strings"}]]},{"t":"Para","c":[{"t":"Str","c":"There’s many ways to format strings in python, with the original one being "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"%"]},{"t":"Str","c":" formatting"}],["https://stackabuse.com/python-string-interpolation-with-the-percent-operator/",""]]},{"t":"Str","c":". But the best way since Python 3.7 is literal f-strings:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"def fn(x):\n  return x * x\n\nx = 5\nprint(f\"for input {x:.1f}, {fn(x)=}\")"]},{"t":"Para","c":[{"t":"Str","c":"Prints: "},{"t":"Code","c":[["",[],[]],"for input 5.0, fn(x)=25"]}]},{"t":"Para","c":[{"t":"Str","c":"Similar to "},{"t":"Code","c":[["",[],[]],"\"x is {x}\".format(x=x)"]},{"t":"Str","c":" but easier to read and write. You can add simple expression inside the {}. The special format specifier "},{"t":"Code","c":[["",[],[]],"f\"{foo=}\""]},{"t":"Str","c":" is the same as doing "},{"t":"Code","c":[["",[],[]],"f\"foo={foo}\""]}]},{"t":"Header","c":[2,["pathlib",[],[]],[{"t":"Str","c":"Pathlib"}]]},{"t":"CodeBlock","c":[["",["py"],[]],"from pathlib import Path\n\nmydir = Path(\"foo\")\n\nmyfile = mydir / \"filename.txt\""]},{"t":"Para","c":[{"t":"Str","c":"If you pass file paths around as strings, you have to figure out when to add slashes and when not to, and unless you always use "},{"t":"Code","c":[["",[],[]],"os.path.sep"]},{"t":"Str","c":" your code will work differently depending on the OS. With pathlib, you can join paths using just the "},{"t":"Code","c":[["",[],[]],"/"]},{"t":"Str","c":" operator, regardless of the OS of the user."}]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"Path"]},{"t":"Str","c":"s have great methods for manipulating filenames that are much more readable than their "},{"t":"Code","c":[["",[],[]],"os.path"]},{"t":"Str","c":" equivalents:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"myfile = Path(\"foo/filename.txt\")\nmyfile.parent # Path(\"foo\")\nmyfile.name # \"filename.txt\"\nmyfile.suffix # \".txt\"\n# replace file extension\nmyfile.with_suffix('.csv') # foo/filename.csv"]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"Path"]},{"t":"Str","c":"s also have neat methods for opening / reading / writing files:"}]},{"t":"CodeBlock","c":[["",["py"],[]],"myfile.write_text(\"hello\")\n\nif myfile.exists():\n  with myfile.open(\"r\") as f:\n    # ...\n    pass\n\ntext = (mydir / \"input.txt\").read_text()\n\n\nfor file in Path(\"foo\").glob(\"*.txt\"):\n  # every txt file in foo/\n  pass"]},{"t":"Header","c":[2,["relative-imports",[],[]],[{"t":"Str","c":"Relative imports"}]]},{"t":"Para","c":[{"t":"Str","c":"The following is fairly common python code:"}]},{"t":"CodeBlock","c":[["",[],[]],"import util\n\nutil.foo()"]},{"t":"Para","c":[{"t":"Str","c":"But what is "},{"t":"Code","c":[["",[],[]],"util"]},{"t":"Str","c":"? It can be either a global module or a local file / directory. If there is a local file named "},{"t":"Code","c":[["",[],[]],"util.py"]},{"t":"Str","c":", it will shadow the corresponding module. This is a pretty common issue, and happens even to "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"experienced devs"}],["https://github.com/pytorch/pytorch/issues/24807#issuecomment-524155619",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"Instead, in my opinion you should always use relative imports if you want to import a relative module instead of global ones."}]},{"t":"CodeBlock","c":[["",["py"],[]],"from . import util\n# or\nfrom .util import foo"]},{"t":"Para","c":[{"t":"Str","c":"Sadly this ambiguity issue is not completely fixeable without a breaking change in python itself, and due to a bad design decision in the Python module system relative imports have "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"some issues when python files are loaded in a specific way called "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"script mode"}]]}],["https://stackoverflow.com/a/28154841/2639190",""]]},{"t":"Str","c":", which you will probably come across sooner or later."}]},{"t":"Header","c":[2,["ordered-unordered-dicts",[],[]],[{"t":"Str","c":"Ordered unordered dicts"}]]},{"t":"Para","c":[{"t":"Str","c":"Since Python 3.6, Python uses a more compact representation of dicts (and thus "},{"t":"Code","c":[["",[],[]],"kwargs"]},{"t":"Str","c":"). Since Python 3.7, it is guaranteed that dicts are always iterated over in insertion order."}]},{"t":"Para","c":[{"t":"Str","c":"This means that every dict is basically an "},{"t":"Code","c":[["",[],[]],"OrderedDict"]},{"t":"Str","c":" except some utility functions are missing. This is really useful, because it means you can use normal dicts as ordered associative arrays."}]},{"t":"CodeBlock","c":[["",["py"],[]],"x = {\n  \"c\": True,\n  \"b\": False,\n  \"d\": False\n}\nfor key in x:\n    # guaranteed to always go through keys in the order \"c\", \"b\", \"d\"!"]},{"t":"Header","c":[2,["multiprocessing",[],[]],[{"t":"Str","c":"Multiprocessing"}]]},{"t":"Para","c":[{"t":"Str","c":"There’s a ton of libraries for multithreading / multiprocessing in python, with varying degrees of magicness. But in Python 3, there’s actually an integrated way to run a function on a large set of data quickly: "},{"t":"Link","c":[["",[],[]],[{"t":"Code","c":[["",[],[]],"multiprocessing.Pool"]}],["https://docs.python.org/3/library/multiprocessing.html",""]]}]},{"t":"CodeBlock","c":[["",["py"],[]],"def f(x):\n    # expensive computation\n    return x * x\n\nfrom multiprocessing import Pool\n\nwith Pool() as p:\n    for result in p.imap(f, [1, 2, 3], chunksize=100):\n      # ... handle result"]},{"t":"Para","c":[{"t":"Str","c":"This code does the same as "},{"t":"Code","c":[["",[],[]],"for i in [1,2,3]: f(i)"]},{"t":"Str","c":" except using all your CPU cores."}]},{"t":"Header","c":[2,["typed-argparse",[],[]],[{"t":"Str","c":"Typed Argparse"}]]},{"t":"Para","c":[{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Argparse"}],["https://docs.python.org/3/library/argparse.html",""]]},{"t":"Str","c":" is a neat library to create a simple command line interface. But arguments are declared as strings, and the IDE can’t know about them."}]},{"t":"Para","c":[{"t":"Str","c":"With "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Typed-Argparse"}],["https://github.com/swansonk14/typed-argument-parser",""]]},{"t":"Str","c":", your arguments are parsed directly into a class instance! It’s a separate library, not integrated in python like argparse, but it’s much neater."}]},{"t":"Para","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"TAP example"}],["https://raw.githubusercontent.com/swansonk14/typed-argument-parser/master/images/tap.png","fig:"]]}]},{"t":"Header","c":[2,["poetry",[],[]],[{"t":"Str","c":"Poetry"}]]},{"t":"Para","c":[{"t":"Str","c":"Here is all the stages of a Python developer’s slow decent into madness:"}]},{"t":"OrderedList","c":[[1,{"t":"Decimal"},{"t":"Period"}],[[{"t":"Para","c":[{"t":"Str","c":"You write single file .py scripts without imports and functions. It’s so easy to get so much done! You feel enlightened."}]}],[{"t":"Para","c":[{"t":"Str","c":"You start splitting your code in multiple functions in .py files, and feel enlightened of how structured your code is now."}]}],[{"t":"Para","c":[{"t":"Str","c":"You need to do some maths, so you learn about "},{"t":"Code","c":[["",[],[]],"pip"]},{"t":"Str","c":" and run "},{"t":"Code","c":[["",[],[]],"pip install numpy"]},{"t":"Str","c":" globally. You feel enlightened about how easy it is to use libraries. It’s as easy as "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"import antigravity"}],["https://xkcd.com/353/",""]]},{"t":"Str","c":"!"}]}],[{"t":"Para","c":[{"t":"Str","c":"At some point you have some multiple projects that need different versions of some libraries. You learn about virtualenvs. You are confused about the difference between "},{"t":"Code","c":[["",[],[]],"venv"]},{"t":"Str","c":", "},{"t":"Code","c":[["",[],[]],"virtualenv"]},{"t":"Str","c":", "},{"t":"Code","c":[["",[],[]],"virtualenvwrapper"]},{"t":"Str","c":", but some random memorized commands works so you start using virtualenvs."}]}],[{"t":"Para","c":[{"t":"Str","c":"You try to use some older library from GitHub. You learn about "},{"t":"Code","c":[["",[],[]],"setup.py"]},{"t":"Str","c":" files and "},{"t":"Code","c":[["",[],[]],"requirements.txt"]},{"t":"Str","c":" files, and you feel enlightened! This is how you define exactly what you need to run your program! The project you’re trying to use has a requirements.txt file like this:"}]},{"t":"CodeBlock","c":[["",[],[]],"pandas\nnumpy"]},{"t":"Para","c":[{"t":"Str","c":"So you eagerly run"}]},{"t":"CodeBlock","c":[["",["sh"],[]],"python -m venv .venv\nsource .venv/bin/activate\npip install -r requirements.txt"]},{"t":"Para","c":[{"t":"Str","c":"Then you try running the project, but it turns out it actually also needs "},{"t":"Code","c":[["",[],[]],"sklearn"]},{"t":"Str","c":". So you try "},{"t":"Code","c":[["",[],[]],"pip install sklearn"]},{"t":"Str","c":" only to realize that "},{"t":"Code","c":[["",[],[]],"sklearn"]},{"t":"Str","c":" is actually a random package from someone else and to get "},{"t":"Code","c":[["",[],[]],"sklearn"]},{"t":"Str","c":" you actually need to install "},{"t":"Code","c":[["",[],[]],"scikit-learn"]},{"t":"Str","c":". You realize that package names are not actually related to the names of python modules (except incidentally) and feel enlightened by the power!"}]},{"t":"Para","c":[{"t":"Str","c":"But the code still doesn’t run, theer’s some weird issue. After an hour of investigation, you find some obscure bug "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"caused by an incompatible change"}],["http://blog.khinsen.net/posts/2017/11/16/a-plea-for-stability-in-the-scipy-ecosystem/",""]]},{"t":"Str","c":" some time 5 years ago in numpy. You try some old numpy versions until you find one that works. You learn about "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"semver"}],["https://devhints.io/semver",""]]},{"t":"Str","c":" and "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"freezing"}],["https://tech.instacart.com/freezing-pythons-dependency-hell-in-2018-f1076d625241",""]]},{"t":"Str","c":", and you feel enlightened! The developer should have just put "},{"t":"Code","c":[["",[],[]],"numpy==1.10"]},{"t":"Str","c":" into their requirements.txt!"}]}],[{"t":"Para","c":[{"t":"Str","c":"You find "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"something that recommends using Conda"}],["https://pytorch.org/get-started/locally/",""]]},{"t":"Str","c":". You are somewhat confused why the conda download is taking so long and eating up 2GB of bandwidth. After accepting a random EULA and having your shell changed prompt always say "},{"t":"Code","c":[["",[],[]],"(base) $"]},{"t":"Str","c":", you realize that in conda, everything is an env! It’s so quick to add libraries, "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"even weird native ones"}],["https://anaconda.org/anaconda/mkl",""]]},{"t":"Str","c":" ! You feel enlightened."}]}],[{"t":"Para","c":[{"t":"Str","c":"You read some documentation and call a python function, but the function does not exist. After some reading, you see that the package you installed via conda is an outdated version. You now understand that conda is a completely different package manager from pip, and that conda packages are actually managed by third parties, some of which are outdated, and many don’t exist at all. You start using "},{"t":"Code","c":[["",[],[]],"pip"]},{"t":"Str","c":" for some things and "},{"t":"Code","c":[["",[],[]],"conda"]},{"t":"Str","c":" for other things, all in the same environment. Sometimes you randomly add "},{"t":"Code","c":[["",[],[]],"-c conda-forge"]},{"t":"Str","c":" when conda install doesn’t work."}]}],[{"t":"Para","c":[{"t":"Str","c":"The find out about the Official Modern Python Packaging tool "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pipenv"}],["https://pipenv.pypa.io/en/latest/",""]]},{"t":"Str","c":"! Pipenv always and automatically manages a virtualenv with the exact dependencies as defined in a "},{"t":"Code","c":[["",[],[]],"Pipfile"]},{"t":"Str","c":", which is like a supercharged "},{"t":"Code","c":[["",[],[]],"requirements.txt"]},{"t":"Str","c":". It’s amazing! Except you soon try to install a package and get a "},{"t":"Code","c":[["",[],[]],"Could not resolve dependencies"]},{"t":"Str","c":" error. You google a while, and figure out that most pypi packages don’t actually have correctly specified dependencies, and that pip just doesn’t really care about that. You also find out that "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pipenv only really pretended to be an official tool"}],["https://chriswarrick.com/blog/2018/07/17/pipenv-promises-a-lot-delivers-very-little/",""]]},{"t":"Str","c":"."}]}],[{"t":"Para","c":[{"t":"Str","c":"You find out about "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"poetry"}],["https://python-poetry.org/",""]]},{"t":"Str","c":". It’s like pipenv but actually fairly good! It only takes 2 minutes to resolve dependencies instead of 10! It even puts your virtualenv in "},{"t":"Code","c":[["",[],[]],"~/.cache"]},{"t":"Str","c":" because it "},{"t":"Emph","c":[{"t":"Str","c":"really"}]},{"t":"Str","c":" doesn’t matter if it gets deleted!"}]}],[{"t":"Para","c":[{"t":"Str","c":"A while later you find the latest development of python dependency management: "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pyflow"}],["https://github.com/David-OConnor/pyflow#why-add-another-python-manager",""]]},{"t":"Str","c":" and "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"pdm"}],["https://github.com/pdm-project/pdm",""]]},{"t":"Str","c":". It uses the same standard "},{"t":"Code","c":[["",[],[]],"pyproject.toml"]},{"t":"Str","c":" format as poetry, but it puts your dependencies in a "},{"t":"Code","c":[["",[],[]],"./__pypackages__"]},{"t":"Str","c":" directory so when running stuff you don’t have to care about activating a virtualenv or always using "},{"t":"Code","c":[["",[],[]],"poetry run python"]},{"t":"Str","c":". … Wait, isn’t that literally just "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"node_modules"}],["https://www.reddit.com/r/ProgrammerHumor/comments/6s0wov/heaviest_objects_in_the_universe/",""]]},{"t":"Str","c":"? The thing JS devs have been complaining about for a decade?"}]}]]]},{"t":"Para","c":[{"t":"Str","c":"Tl;dr:"}]},{"t":"Para","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"xkcd"}],["https://imgs.xkcd.com/comics/python_environment.png","fig:"]]}]}]}}},"__N_SSG":true},"page":"/[year]/[post]","query":{"year":"2021","post":"python-features"},"buildId":"NlBwkDxJnMQWkSmnzlBWh","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>