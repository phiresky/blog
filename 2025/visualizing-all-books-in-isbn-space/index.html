<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><title data-next-head="">Visualizing all books of the world in ISBN-Space - phiresky&#x27;s blog</title><meta name="description" content="Libraries have been trying to collect humanity’s knowledge almost since the invention of writing. In the digital age, it might actually be possible to create a comprehensive collection of all human writing meeting certain criteria. That’s what shadow libraries do - collect and share as many books" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1" data-next-head=""/><link rel="alternate" type="application/rss+xml" title="RSS feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/rss.xml" data-next-head=""/><link rel="alternate" type="application/atom+xml" title="Atom feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/atom.xml" data-next-head=""/><link rel="alternate" type="application/json" title="JSON feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/feed.json" data-next-head=""/><style data-next-head="">
          body {
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;
          }
      </style><link rel="preload" href="/blog/_next/static/css/176ecc217408b6d5.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/176ecc217408b6d5.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/ca399fb16b1ff7a4.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/ca399fb16b1ff7a4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script defer="" src="/blog/_next/static/chunks/06447f4e.b41930dd9420f16e.js"></script><script defer="" src="/blog/_next/static/chunks/225.64ce7263224d8c5d.js"></script><script src="/blog/_next/static/chunks/webpack-b71e6f5e83c3e25f.js" defer=""></script><script src="/blog/_next/static/chunks/framework-dd2475e04127183a.js" defer=""></script><script src="/blog/_next/static/chunks/main-dded5530337538c6.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-4690c3d9b8989c63.js" defer=""></script><script src="/blog/_next/static/chunks/768-97507726c6ad4e38.js" defer=""></script><script src="/blog/_next/static/chunks/767-8dd3b40e4e29c204.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5Byear%5D/%5Bpost%5D-0c2afe7cbabce6c1.js" defer=""></script><script src="/blog/_next/static/PEPLuuxm2swHrygpZSajI/_buildManifest.js" defer=""></script><script src="/blog/_next/static/PEPLuuxm2swHrygpZSajI/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><main class="lh-copy"><div class="relative tc bg-dark-gray"><div class="mw7 center white"><div class="pv4"><h1 class="f2 normal lh-title ma0 pa0"><a class="white no-underline" href="/blog/">phiresky&#x27;s blog</a></h1><h4 class="normal o-70 ma0 pt2 pb3 ph1">Code, Craft, and Creativity</h4><div><a class="dib f6 white no-underline pa1 ma1" href="/blog/">Blog</a><a href="https://github.com/phiresky/" class="dib f6 white no-underline pa1 ma1">GitHub</a></div></div></div></div><div class="content center mw7 pa3 pa4-ns"><h1 class="mt0 lh-title mb1">Visualizing all books of the world in ISBN-Space</h1><small class="db ttu o-40"><time dateTime="2025-01-31T00:00:00.000Z">Jan 31, 2025</time></small><p>Libraries have been trying to collect humanity’s knowledge almost since the invention of writing. In the digital age, it might actually be possible to create a comprehensive collection of all human writing meeting certain criteria. That’s what <a href="https://en.wikipedia.org/wiki/Shadow_library">shadow libraries</a> do - collect and share as many books as possible.</p><p>One shadow library, Anna’s Archive (which I will not link here directly due to copyright concerns), recently posed a question: <em>How could we effectively visualize 100,000,000 books or more at once?</em> There’s lots of data to view: Titles, authors, which countries the books come from, which publishers, how old they are, how many libraries hold them, whether they are available digitally, etc.</p><p>International Standard Book Numbers (<a href="https://en.wikipedia.org/wiki/ISBN">ISBNs</a>) are 13-digit numbers that are assigned to almost all published books. Since the first three digits are fixed (currently only <code class="not-highlighted">978-</code> and <code class="not-highlighted">979-</code>) and the last digit is a checksum, this means <b>the total ISBN13-Space only has two billion slots</b>. Here is my interactive visualization of that space:</p><p><a href="https://phiresky.github.io/isbn-visualization/" target="_blank">Click here to view the visualization in full screen (esp. on mobile)</a>.</p><div class="isbn-visualization-iframe-container"><div><iframe src="https://phiresky.github.io/isbn-visualization/" class="isbn-visualization-iframe"></div>.<div></iframe></div></div><p>You can choose a few different datasets, look for individual books, filter by publication year, and even create a custom visualization based on multiple datasets using custom shaders. If you zoom in all the way, you get a nice bookshelf-like representation.</p><p>Here’s how I did it.</p><h2 id="the-inherent-structure-of-isbns">The inherent structure of ISBNs</h2><p>The <code class="not-highlighted">978-</code>/<code class="not-highlighted">979-</code> prefix of an ISBN comes from the fact that ISBN13s are a subset of <a href="https://en.wikipedia.org/wiki/International_Article_Number">European Article Numbers</a>, which have a three-digit prefix. This fixed prefix is affectionately called <a href="https://en.wikipedia.org/wiki/Bookland">Bookland</a>. We can thus ignore it almost completely.</p><p>Large blocks of 10k to 100 million ISBNs are assigned by the <em>International ISBN Agency</em> to international organizations. Then, each country has their own method of subdividing their blocks into publishers.</p><p>The important part is that ISBN blocks are always assigned by <b>prefix</b>. For example, <code class="not-highlighted">978-4</code> is assigned to Japan, and Japan assigned <code class="not-highlighted">978-4-312</code> to one publisher. That publisher then assigns the articles <code class="not-highlighted">000000-99999</code>, leading to an ISBN of <code class="not-highlighted">978-4-312-99999-X</code>, where X is a checksum. The longer the country prefix is, the fewer books can be assigned within it. For example, while Japan has a space of 100 million ISBNs, Singapore has a prefix of <code class="not-highlighted">978-9971-</code>, allowing only 100 thousand ISBNs.</p><h3 id="space-filling-curves">Space-filling curves</h3><p>Stripping ISBNs of their pre-and suffix, they are a single decimal between 0 and 2 billion. We need some way to project this one-dimensional space into a two-dimensional space. The easiest way would be to simply fill pixels row-wise from the top, which results in an image like this:</p><figure><img src="./oclc_isbns_smaller.png" title=""/><figcaption>ISBN-Space presented linearly. Whiter pixels contain more books. You can see the line-stretched structure.</figcaption></figure><p>The issue with this is that smaller regions are stretched more and more horizontally, at the extreme a region is 1000 pixels wide and 1 pixel high. This makes it hard to see the inherent structure of ISBNs.</p><p>Thus, <a href="https://news.ycombinator.com/item?id=42652577">as people on Hacker News discussed</a>, a better way to fill an image is using a <a href="https://en.wikipedia.org/wiki/Space-filling_curve">space-filling curve</a>.</p><p>The commonly suggested Hilbert-curve is nice, but it leads to artifacts:</p><figure><img src="hilbert.png" title=""/><figcaption>Left: a Hilbert curve. Right: ISBN-space projected into a hilbert curve. You can see that the regions look like they have spatial structure, but this is purely an artifact of the curve used. (credit: Wikipedia, Hypha A)</figcaption></figure><p>While the Hilbert curve helps make regions more <span class="quoted">&quot;<!-- -->square<!-- -->&quot;</span> (smaller regions do not get wider and wider), it introduces structure where there is none. Since structures that are not actually part of data are a huge issue in data visualization, we want to avoid this.</p><h3 id="the-bookshelf-curve">The <span class="quoted">&quot;<!-- -->Bookshelf<!-- -->&quot;</span>-Curve</h3><p>ISBNs are inherently decimal, and we can use this to create a space-filling curve that is both simple to implement, easy to understand, and visually appealing:</p><figure><img src="bookshelf-curve.drawio.svg" title=""/><figcaption>The space-filling curve I call <span class="quoted">&quot;<!-- -->Bookshelf-Curve<!-- -->&quot;</span> because each second layer looks like an upright bookshelf, and each other layer like a stack of books.</figcaption></figure><p>The first decimal layer contains the digits 0-9 next to each other, the next one has them on top of each other, recursively. If we want to keep the aspect ratio of the rectangles on the first layer <span data-testid="react-katex"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>×</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a\times b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span> and second layer <span data-testid="react-katex"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>b</mi><mo>×</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(b \times c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span> the same, this leads to an aspect ratio of each block of 3.16 to 1:</p><p><div data-testid="react-katex"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mi>a</mi><mi>b</mi></mfrac><mo>=</mo><mfrac><mi>b</mi><mi>c</mi></mfrac><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> \frac{a}{b} = \frac{b}{c}. </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></span></div></p><p><div data-testid="react-katex"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mi>a</mi><mi>c</mi></mfrac><mo>=</mo><mfrac><mn>10</mn><mn>1</mn></mfrac><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> \frac{a}{c} = \frac{10}{1}. </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></span></div></p><p><div data-testid="react-katex"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mfrac><mi>a</mi><mi>b</mi></mfrac><mo>=</mo><mfrac><mrow><mn>10</mn><mo>⋅</mo><mi>b</mi></mrow><mi>a</mi></mfrac><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mfrac><msup><mi>a</mi><mn>2</mn></msup><msup><mi>b</mi><mn>2</mn></msup></mfrac><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex"> \implies \frac{a}{b} = \frac{10\cdot b}{a} \implies \frac{a^2}{b^2} = 10 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.549em;vertical-align:-0.024em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span></span></div></p><p><div data-testid="react-katex"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>a</mi><mo>:</mo><mi>b</mi><mo>=</mo><msqrt><mn>10</mn></msqrt><mo>≈</mo><mn>3.16</mn><mo>:</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> \implies a:b = \sqrt{10} \approx 3.16:1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.549em;vertical-align:-0.024em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.0839em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9561em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">10</span></span></span><span style="top:-2.9161em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.0839em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3.16</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></div></p><p>This is very similar to <a href="https://en.wikipedia.org/wiki/ISO_216">A4 paper</a>, which is defined as follows: Take a rectangle of size <span data-testid="react-katex"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1m^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>, such that if you fold it in half you get a rectangle of the same aspect ratio. The first recursive iteration is A0-paper, the fourth iteration is A4. They all have an aspect ratio of <span data-testid="react-katex"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>:</mo><msqrt><mn>2</mn></msqrt></mrow><annotation encoding="application/x-tex">1:\sqrt{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1328em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span></span></span></span></span></span></span></span></span></span>.</p><p>We just divide each paper into ten sections, not two. Even better, with this curve, the coordinate transformation is really simple!</p><figure><img src="coordinates.drawio.svg" title=""/><figcaption>Transforming an ISBN into coordinates by simply taking every second digit</figcaption></figure><p>This transformation is really simple, but this took me ages to realize and I tried to generalize it, so my code for it is <a href="https://github.com/phiresky/isbn-visualization/blob/master/src/projections/bookshelf.ts#L49-L100">50 lines</a>.</p><h2 id="map-tiles">Map tiles</h2><p>Now that we have our space, we can generate tiled images for each prefix:</p><figure><img src="publication-date-978-06-small.png" title=""/><figcaption>A single tile containing the average publication dates for the prefix 978-06</figcaption></figure><p>I targeted a size of ~100kB per tile, which resulted in a size of 2000 pixels times 633 (<span data-testid="react-katex"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>2000</mn><mi mathvariant="normal">/</mi><msqrt><mn>10</mn></msqrt></mrow><annotation encoding="application/x-tex">=2000/\sqrt{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1572em;vertical-align:-0.25em;"></span><span class="mord">2000/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">10</span></span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span></span></span></span></span></span></span></span></span></span>).</p><p>For each dataset, we store different information per pixel. In this case, I subtracted 1800 from the publication year to get a range of 1800 to 2055 in 8 bits. The red channel contains the average publication year of each book in the pixel, the blue channel contains the ratio of books present (e.g. if 50% of books exist, blue channel would be 127/255).</p><p>At the maximum zoom level on the other hand, I decided to map exactly 1 book to 1 pixel for accuracy:</p><figure><img src="full-zoom.png" title=""/><figcaption>Zoom level 4 (1 book = 1 pixel) and zoom level 3</figcaption></figure><h2 id="shaders">Shaders</h2><p>Originally I stored RGB data directly in the map tiles, but in order to increase the flexibility I decided to store more abstract data, and do the actual rendering on the GPU using GLSL Shaders. This has a few advantages:</p><ul><li>Color scheme can be chosen later</li><li>We can apply arbitrary transformation or filters that apply instantly</li><li>We can combine multiple datasets on the fly</li></ul><p>For example, let’s take the publisher dataset. We store years from 1800 to 2055. But 95% of data is in the range 1985 to 2024. So we can reduce it to this range in the shader, which looks like this:</p><pre class="glsl" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-glsl" style="white-space:pre;color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">vec4</span><span> </span><span class="token token" style="color:#f08d49">colorOfPixel</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">vec2</span><span> uv</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">vec4</span><span> bookColor </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">texture2D</span><span class="token token" style="color:#ccc">(</span><span>$dataset_publication_date</span><span class="token token" style="color:#ccc">,</span><span> uv</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#999">// average publication year in this pixel</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> publicationYear </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span>bookColor</span><span class="token token" style="color:#ccc">.</span><span>r </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#f08d49">255.</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#f08d49">1800.</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#999">// 0-100% number of books exist</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> fillRate </span><span class="token token" style="color:#67cdcc">=</span><span> bookColor</span><span class="token token" style="color:#ccc">.</span><span>b</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> minYear </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">1985.</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> maxYear </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">2025.</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> brightness </span><span class="token token" style="color:#67cdcc">=</span><span> fillRate</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#999">// scale year to range 0 to 1</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> lerp </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">clamp</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span>publicationYear </span><span class="token token" style="color:#67cdcc">-</span><span> minYear</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span> </span><span class="token token" style="color:#ccc">(</span><span>maxYear </span><span class="token token" style="color:#67cdcc">-</span><span> minYear</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">0.</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">1.</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#f08d49">heatmapColor</span><span class="token token" style="color:#ccc">(</span><span>lerp</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">*</span><span> brightness</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></pre><p><code class="not-highlighted">vec4 heatmapColor(float)</code> is a function that converts a 0-1 value to the chosen color scale of the user, by sampling another texture.</p><p>Of course, we can also easily play with non-linear scales and adjust ranges as we want.</p><p>Here’s an example that compares two datasets:</p><pre class="glsl" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-glsl" style="white-space:pre;color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">vec4</span><span> </span><span class="token token" style="color:#f08d49">colorOfPixel</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">vec2</span><span> uv</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">vec4</span><span> present_all </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">texture2D</span><span class="token token" style="color:#ccc">(</span><span>$dataset_all</span><span class="token token" style="color:#ccc">,</span><span> uv</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">vec4</span><span> present_md5 </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">texture2D</span><span class="token token" style="color:#ccc">(</span><span>$dataset_md5</span><span class="token token" style="color:#ccc">,</span><span> uv</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">vec4</span><span> present_gradient </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">heatmapColor</span><span class="token token" style="color:#ccc">(</span><span>present_md5</span><span class="token token" style="color:#ccc">.</span><span>x </span><span class="token token" style="color:#67cdcc">/</span><span> present_all</span><span class="token token" style="color:#ccc">.</span><span>x</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#f08d49">brightnessWithGlow</span><span class="token token" style="color:#ccc">(</span><span>present_all</span><span class="token token" style="color:#ccc">.</span><span>x</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#999">// add publishers only in background (when brightness of gradient &gt; 0.1);</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> publisherStrength </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">length</span><span class="token token" style="color:#ccc">(</span><span>present_gradient</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#f08d49">1.1</span><span> </span><span class="token token" style="color:#67cdcc">?</span><span> </span><span class="token token" style="color:#f08d49">0.0</span><span> </span><span class="token token" style="color:#67cdcc">:</span><span> PUBLISHERS_BRIGHTNESS</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#f08d49">postprocessColor</span><span class="token token" style="color:#ccc">(</span><span>present_gradient</span><span class="token token" style="color:#ccc">,</span><span> publisherStrength</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></pre><p>The <code class="not-highlighted">$dataset_x</code> syntax is not part of GLSL, but rather a very simple (regex) templating syntax, that allows me to only load the images that the shader actually reads from.</p><p>You can edit the used shader directly in the visualization by going to the <b>⚙️ Advanced</b> options, it updates live. The meaning of the pixels in each dataset is described in <a href="https://github.com/phiresky/isbn-visualization">the readme</a>.</p><h3 id="the-bookshelf-view">The bookshelf-view</h3><p>In order to improve the visuals, at the fully zoomed in view, each pixel gets a styling resembling a book:</p><figure><img src="bookshelf-example.png" title=""/><figcaption>Side-by-side comparison of the bookshelf-shader disabled and enabled (toggleable in advanced options). Each book is assigned a random width, height, and pattern.</figcaption></figure><p>It’s not really what books looks like, but it makes the fully zoomed in view look much more alive. This styling is purely <a href="https://github.com/phiresky/isbn-visualization/blob/master/src/lib/shaders.ts#L105-L151">implemented in the shader</a>. The hardest part was getting a random-number generator to work the same within GLSL and JavaScript, since we need to know the book-height in order to set the text boundaries.</p><p>Since the styling is in the shader, we can make it smoothly appear by simply passing in the current zoom as an uniform and fading it in:</p><pre class="glsl" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-glsl" style="white-space:pre;color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">uniform</span><span> </span><span class="token token" style="color:#cc99cd">float</span><span> CURRENT_ZOOM</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">vec4</span><span> </span><span class="token token" style="color:#f08d49">bookshelfOverlayDependingOnZoom</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">vec4</span><span> bookColor</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> minZoom </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">90.0</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#ccc">(</span><span>CURRENT_ZOOM </span><span class="token token" style="color:#67cdcc">&lt;</span><span> minZoom</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">return</span><span> bookColor</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> maxZoom </span><span class="token token" style="color:#67cdcc">=</span><span> minZoom </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#f08d49">sqrt</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">10.0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span> </span><span class="token token" style="color:#999">// fade between two zoom levels</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">vec4</span><span> overlay </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">bookshelfOverlay</span><span class="token token" style="color:#ccc">(</span><span>bookColor</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">float</span><span> fadeIn </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">clamp</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span>CURRENT_ZOOM </span><span class="token token" style="color:#67cdcc">-</span><span> minZoom</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span> </span><span class="token token" style="color:#ccc">(</span><span>maxZoom </span><span class="token token" style="color:#67cdcc">-</span><span> minZoom</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">0.0</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">1.0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#f08d49">mix</span><span class="token token" style="color:#ccc">(</span><span>bookColor</span><span class="token token" style="color:#ccc">,</span><span> overlay</span><span class="token token" style="color:#ccc">,</span><span> fadeIn</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></pre><p>As far as I know, shaders work in ~32x32 pixel blocks in lockstep, which means that <em>every branch</em> that happens in <em>any pixel</em> in a block needs to be executed. But the zoom level is the same for all pixels, so this should even be performant.</p><h2 id="trees-text-performance">Trees, Text, Performance</h2><p>Just like the image tiles, I render text in a hierarchical structure depending on zoom levels and view frustrum culling. Everything is implemented using <a href="https://r3f.docs.pmnd.rs">react-threejs-fiber</a>. The scene is described declaratively, React recursively adds scene elements as the view is moved around. Here’s an approximation of what the hierarchical Tree component looks like:</p><pre class="typescript" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-typescript" style="white-space:pre;color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">RenderTree</span><span class="token token" style="color:#ccc">(</span><span>props</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span> prefix</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token maybe-class-name">IsbnPrefixWithDashes</span><span> </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#999">// compute where we should place text and whether we should render children.</span><span>
</span><span>  </span><span class="token token" style="color:#999">// depends on current view frustrum and zoom level</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span> plane</span><span class="token token" style="color:#ccc">,</span><span> renderChildren </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">getDetailLevel</span><span class="token token" style="color:#ccc">(</span><span>props</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">prefix</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#999">// load prefix details asynchronously using a mobx observable</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> prefixDetails </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useMemo</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#f08d49">fromPromise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">getPrefixDetails</span><span class="token token" style="color:#ccc">(</span><span>props</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">prefix</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">[</span><span>props</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">prefix</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#999">// load the relevant textures for the dataset and create a GLSL material</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> material </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useMemo</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#f08d49">fromPromise</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">getIsbnShaderMaterial</span><span class="token token" style="color:#ccc">(</span><span>props</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">prefix</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">[</span><span>props</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">prefix</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#999">// these elements are part of the threejs WebGL scene graph</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>group position</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>plane</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">position</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">Plane</span><span> args</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>plane</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">size</span><span class="token token" style="color:#ccc">}</span><span> material</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>material</span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#999">/* opt out of the threejs scene graph and add a html element
</span><span class="token token" style="color:#999">          instead, using 3D CSS transforms */</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">Html</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">{</span><span>prefixDetails</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">state</span><span> </span><span class="token token" style="color:#67cdcc">===</span><span> </span><span class="token token" style="color:#7ec699">&quot;fulfilled&quot;</span><span> </span><span class="token token" style="color:#67cdcc">&amp;&amp;</span><span>
</span><span>          prefixDetails</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">value</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">publisherName</span><span class="token token" style="color:#ccc">}</span><span class="token token spread" style="color:#67cdcc">...</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">Html</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">{</span><span>renderChildren </span><span class="token token" style="color:#67cdcc">&amp;&amp;</span><span>
</span><span>        digits</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">map</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span>i</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span>
</span><span>          </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">RenderTree</span><span> prefix</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>props</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">prefix</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> i</span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>group</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span></code></pre><p>I had lots of performance problems initially with rendering a lot of text this way. I spent a lot of time trying and failing to render text into images/canvas in JS without having to implement my own text wrapping and layouting engine. The best approach was to <a href="https://stackoverflow.com/a/25760896/2639190">embed the HTML as a <code class="not-highlighted">&lt;foreignObject /&gt;</code> within an SVG</a>, then render that to a canvas using <code class="not-highlighted">drawImage</code>, then converting that to an image and loading it as a texture.</p><p>This works, but it caused <code class="not-highlighted">20ms</code> lags every time, synchronously in the rendering process. I struggled to move this to a WebWorker, but it turns out <a href="https://stackoverflow.com/a/79196371/2639190">it’s impossible to draw an SVG in a WebWorker</a>.</p><p>After all this frustrating effort, it turns out I could fix most of my performance concerns by just reducing the HTML elements, limiting DOM content added per frame, and especially removing a stack of <code class="not-highlighted">text-shadow</code> CSS filters, which are apparently horrible for performance.</p><h2 id="barcodes">Barcodes</h2><p>At max zoom, you will also notice that each book has a barcode. I mainly added these to reinforce the concept of what we are looking at: Books ordered by ISBN. I started with some libraries to render bar codes, but it turns out there’s actually a TTF font that just renders a 13-digit number as a barcode! It even calculates the check digit itself: <a href="https://graphicore.github.io/librebarcode/" class="auto-linked">https://graphicore.github.io/librebarcode/</a>. Pretty convenient, and performant too, due to all the optimization OSs do for text rendering.</p><h2 id="publisher-ranges">Publisher ranges</h2><p>Each <span class="quoted">&quot;<!-- -->group<!-- -->&quot;</span> (usually countries) has a large range, and each publisher has a smaller range within a group. I decided to visualize this using randomly assigned colors unique for each group and publisher:</p><figure><img src="publishers.png" title=""/><figcaption>Looking at publishers shows their range size. If a publisher has multiple ranges the color is the same.</figcaption></figure><p>In order to allow highlighting all ranges of a publisher simultaneously, I simply give each publisher a unique ID and store this as the RGB components:</p><pre class="glsl" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-glsl" style="white-space:pre;color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">ivec4</span><span> data </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">getIntegerRGB</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">texture2D</span><span class="token token" style="color:#ccc">(</span><span>$dataset_publishers</span><span class="token token" style="color:#ccc">,</span><span> vUv</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">int</span><span> publisherId </span><span class="token token" style="color:#67cdcc">=</span><span> data</span><span class="token token" style="color:#ccc">.</span><span>r </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#f08d49">65536</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> data</span><span class="token token" style="color:#ccc">.</span><span>g </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#f08d49">256</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> data</span><span class="token token" style="color:#ccc">.</span><span>b</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#ccc">(</span><span>HIGHLIGHTED_PUBLISHER_ID </span><span class="token token" style="color:#67cdcc">==</span><span> publisherId</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#cc99cd">vec4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1.</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span> </span><span class="token token" style="color:#999">// white</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span></code></pre><p>This part I’m not extremely happy with. The publisher colors clash with the heatmap color scale, and country ranges are hard to see.</p><h2 id="flight">Flight</h2><p>If you search for a book or click on the minimap, you will fly there. Calculating a good looking flight path is actually much trickier than it seems. I’m not sure how Google Earth does it. After getting a mediocre result by fitting a parabola, I nerd sniped a friend of mine to get him to do it, here’s what he said:</p><blockquote><p><span class="quoted">&quot;<!-- -->Somehow you’re pretending reality is polar coordinates and converting that to cartesian coordinates?<!-- -->&quot;</span> - <span class="quoted">&quot;<!-- -->Yes it transforms the points into a space which has the property that for a certain zoom level (which you potentially can’t reach at all) all coordinates lie on one point but all ground points are still the same distance away… aka a semicircle (or less) where the edge of the circle has the xy points zoomed in at maximum… in other words, a space that represents the speed and spatiality of the original space in one… in which the direct route is then theoretically the fastest route…. Unfortunately, this only applies if the increase in speed depends linearly on the zoom level…. but this is not the case with normal zooming… there it is rather quadratic… so every zoom level further up makes you move twice as fast to the right left… but this somehow results in a strange non-linear space with strange properties and I haven’t managed to define a distance metric in there, let alone the shortest path between two points<!-- -->&quot;</span></p><p>– my friend rambling about calculating flight paths</p></blockquote><figure><img src="blub-space.png" title=""/><figcaption>Blub-space transformation for smooth flight paths. This is what he sent me to try and explain it.</figcaption></figure><p>The end result isn’t perfect and it feels a bit overengineered at 500 lines of code, but it works better than my original approach.</p><h2 id="architecture">Architecture</h2><h3 id="backend">Backend</h3><p>Since we can just store our image tiles as PNG and our data trees as JSON, we don’t need any backend! We just need a static file host, like Github Pages to dump some HTML, JS, CSS, PNG, and JSON.</p><h3 id="frontend">Frontend</h3><p>I used ThreeJS, React, MobX. This is a very comfortable combination to create reactive declarative GPU-accelerated 2D/3D-scenes, with easy reusability of components. I can recommend it.</p><h2 id="processing-scripts">Processing Scripts</h2><p>There’s a set of processing scripts, mostly written in JS (directly writing out JSON and PNG files), but one of them written in Rust since it has to read in a 250GByte source file, writing output to SQLite.</p><h2 id="conclusion">Conclusion</h2><p>In the end, we have a very flexible way of visualizing all books that have been published with an ISBN. I enjoyed working on this project a lot. In the end, it was made possible by what would in software be called a bad choice - using an identifier that can only barely fit enough elements. If you tried the same with UUIDs, you’d have purely vast emptiness ;)</p><p>The source code is available at <a href="https://github.com/phiresky/isbn-visualization" class="auto-linked">https://github.com/phiresky/isbn-visualization</a>.</p></div><footer class="center w5 f6 tc mt4"><p><a href="https://github.com/phiresky/blog/blob/master/posts/2025/visualizing-all-books-in-isbn-space.md">View post source on GitHub</a></p></footer><div></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"filename":"2025/visualizing-all-books-in-isbn-space.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2025-01-31","hidden":true,"references":[],"title":"Visualizing all books of the world in ISBN-Space","url2cite-link-output":"sup"},"preview":"Libraries have been trying to collect humanity’s knowledge almost since the invention of writing. In the digital age, it might actually be possible to create a comprehensive collection of all human writing meeting certain criteria. That’s what shadow libraries do - collect and share as many books","content_ast":[{"t":"Para","c":[{"t":"Str","c":"Libraries have been trying to collect humanity’s knowledge almost since the invention of writing. In the digital age, it might actually be possible to create a comprehensive collection of all human writing meeting certain criteria. That’s what "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"shadow libraries"}],["https://en.wikipedia.org/wiki/Shadow_library",""]]},{"t":"Str","c":" do - collect and share as many books as possible."}]},{"t":"Para","c":[{"t":"Str","c":"One shadow library, Anna’s Archive (which I will not link here directly due to copyright concerns), recently posed a question: "},{"t":"Emph","c":[{"t":"Str","c":"How could we effectively visualize 100,000,000 books or more at once?"}]},{"t":"Str","c":" There’s lots of data to view: Titles, authors, which countries the books come from, which publishers, how old they are, how many libraries hold them, whether they are available digitally, etc."}]},{"t":"Para","c":[{"t":"Str","c":"International Standard Book Numbers ("},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"ISBNs"}],["https://en.wikipedia.org/wiki/ISBN",""]]},{"t":"Str","c":") are 13-digit numbers that are assigned to almost all published books. Since the first three digits are fixed (currently only "},{"t":"Code","c":[["",[],[]],"978-"]},{"t":"Str","c":" and "},{"t":"Code","c":[["",[],[]],"979-"]},{"t":"Str","c":") and the last digit is a checksum, this means "},{"t":"Strong","c":[{"t":"Str","c":"the total ISBN13-Space only has two billion slots"}]},{"t":"Str","c":". Here is my interactive visualization of that space:"}]},{"t":"Para","c":[{"t":"Link","c":[["",[],[["target","_blank"]]],[{"t":"Str","c":"Click here to view the visualization in full screen (esp. on mobile)"}],["https://phiresky.github.io/isbn-visualization/",""]]},{"t":"Str","c":"."}]},{"t":"Div","c":[["",["isbn-visualization-iframe-container"],[]],[{"t":"RawBlock","c":["html","\u003ciframe src=\"https://phiresky.github.io/isbn-visualization/\" class=\"isbn-visualization-iframe\"\u003e"]},{"t":"Plain","c":[{"t":"Str","c":"."}]},{"t":"RawBlock","c":["html","\u003c/iframe\u003e"]}]]},{"t":"Para","c":[{"t":"Str","c":"You can choose a few different datasets, look for individual books, filter by publication year, and even create a custom visualization based on multiple datasets using custom shaders. If you zoom in all the way, you get a nice bookshelf-like representation."}]},{"t":"Para","c":[{"t":"Str","c":"Here’s how I did it."}]},{"t":"Header","c":[2,["the-inherent-structure-of-isbns",[],[]],[{"t":"Str","c":"The inherent structure of ISBNs"}]]},{"t":"Para","c":[{"t":"Str","c":"The "},{"t":"Code","c":[["",[],[]],"978-"]},{"t":"Str","c":"/"},{"t":"Code","c":[["",[],[]],"979-"]},{"t":"Str","c":" prefix of an ISBN comes from the fact that ISBN13s are a subset of "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"European Article Numbers"}],["https://en.wikipedia.org/wiki/International_Article_Number",""]]},{"t":"Str","c":", which have a three-digit prefix. This fixed prefix is affectionately called "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Bookland"}],["https://en.wikipedia.org/wiki/Bookland",""]]},{"t":"Str","c":". We can thus ignore it almost completely."}]},{"t":"Para","c":[{"t":"Str","c":"Large blocks of 10k to 100 million ISBNs are assigned by the "},{"t":"Emph","c":[{"t":"Str","c":"International ISBN Agency"}]},{"t":"Str","c":" to international organizations. Then, each country has their own method of subdividing their blocks into publishers."}]},{"t":"Para","c":[{"t":"Str","c":"The important part is that ISBN blocks are always assigned by "},{"t":"Strong","c":[{"t":"Str","c":"prefix"}]},{"t":"Str","c":". For example, "},{"t":"Code","c":[["",[],[]],"978-4"]},{"t":"Str","c":" is assigned to Japan, and Japan assigned "},{"t":"Code","c":[["",[],[]],"978-4-312"]},{"t":"Str","c":" to one publisher. That publisher then assigns the articles "},{"t":"Code","c":[["",[],[]],"000000-99999"]},{"t":"Str","c":", leading to an ISBN of "},{"t":"Code","c":[["",[],[]],"978-4-312-99999-X"]},{"t":"Str","c":", where X is a checksum. The longer the country prefix is, the fewer books can be assigned within it. For example, while Japan has a space of 100 million ISBNs, Singapore has a prefix of "},{"t":"Code","c":[["",[],[]],"978-9971-"]},{"t":"Str","c":", allowing only 100 thousand ISBNs."}]},{"t":"Header","c":[3,["space-filling-curves",[],[]],[{"t":"Str","c":"Space-filling curves"}]]},{"t":"Para","c":[{"t":"Str","c":"Stripping ISBNs of their pre-and suffix, they are a single decimal between 0 and 2 billion. We need some way to project this one-dimensional space into a two-dimensional space. The easiest way would be to simply fill pixels row-wise from the top, which results in an image like this:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"ISBN-Space presented linearly. Whiter pixels contain more books. You can see the line-stretched structure."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"ISBN-Space presented linearly. Whiter pixels contain more books. You can see the line-stretched structure."}],["./oclc_isbns_smaller.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"The issue with this is that smaller regions are stretched more and more horizontally, at the extreme a region is 1000 pixels wide and 1 pixel high. This makes it hard to see the inherent structure of ISBNs."}]},{"t":"Para","c":[{"t":"Str","c":"Thus, "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"as people on Hacker News discussed"}],["https://news.ycombinator.com/item?id=42652577",""]]},{"t":"Str","c":", a better way to fill an image is using a "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"space-filling curve"}],["https://en.wikipedia.org/wiki/Space-filling_curve",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"The commonly suggested Hilbert-curve is nice, but it leads to artifacts:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Left: a Hilbert curve. Right: ISBN-space projected into a hilbert curve. You can see that the regions look like they have spatial structure, but this is purely an artifact of the curve used. (credit: Wikipedia, Hypha A)"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Left: a Hilbert curve. Right: ISBN-space projected into a hilbert curve. You can see that the regions look like they have spatial structure, but this is purely an artifact of the curve used. (credit: Wikipedia, Hypha A)"}],["hilbert.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"While the Hilbert curve helps make regions more "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"square"}]]},{"t":"Str","c":" (smaller regions do not get wider and wider), it introduces structure where there is none. Since structures that are not actually part of data are a huge issue in data visualization, we want to avoid this."}]},{"t":"Header","c":[3,["the-bookshelf-curve",[],[]],[{"t":"Str","c":"The "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Bookshelf"}]]},{"t":"Str","c":"-Curve"}]]},{"t":"Para","c":[{"t":"Str","c":"ISBNs are inherently decimal, and we can use this to create a space-filling curve that is both simple to implement, easy to understand, and visually appealing:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"The space-filling curve I call "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Bookshelf-Curve"}]]},{"t":"Str","c":" because each second layer looks like an upright bookshelf, and each other layer like a stack of books."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"The space-filling curve I call "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Bookshelf-Curve"}]]},{"t":"Str","c":" because each second layer looks like an upright bookshelf, and each other layer like a stack of books."}],["bookshelf-curve.drawio.svg",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"The first decimal layer contains the digits 0-9 next to each other, the next one has them on top of each other, recursively. If we want to keep the aspect ratio of the rectangles on the first layer "},{"t":"Math","c":[{"t":"InlineMath"},"(a\\times b)"]},{"t":"Str","c":" and second layer "},{"t":"Math","c":[{"t":"InlineMath"},"(b \\times c)"]},{"t":"Str","c":" the same, this leads to an aspect ratio of each block of 3.16 to 1:"}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\frac{a}{b} = \\frac{b}{c}. "]}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\frac{a}{c} = \\frac{10}{1}. "]}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\implies \\frac{a}{b} = \\frac{10\\cdot b}{a} \\implies \\frac{a^2}{b^2} = 10 "]}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\implies a:b = \\sqrt{10} \\approx 3.16:1 "]}]},{"t":"Para","c":[{"t":"Str","c":"This is very similar to "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"A4 paper"}],["https://en.wikipedia.org/wiki/ISO_216",""]]},{"t":"Str","c":", which is defined as follows: Take a rectangle of size "},{"t":"Math","c":[{"t":"InlineMath"},"1m^2"]},{"t":"Str","c":", such that if you fold it in half you get a rectangle of the same aspect ratio. The first recursive iteration is A0-paper, the fourth iteration is A4. They all have an aspect ratio of "},{"t":"Math","c":[{"t":"InlineMath"},"1:\\sqrt{2}"]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"We just divide each paper into ten sections, not two. Even better, with this curve, the coordinate transformation is really simple!"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Transforming an ISBN into coordinates by simply taking every second digit"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Transforming an ISBN into coordinates by simply taking every second digit"}],["coordinates.drawio.svg",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"This transformation is really simple, but this took me ages to realize and I tried to generalize it, so my code for it is "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"50 lines"}],["https://github.com/phiresky/isbn-visualization/blob/master/src/projections/bookshelf.ts#L49-L100",""]]},{"t":"Str","c":"."}]},{"t":"Header","c":[2,["map-tiles",[],[]],[{"t":"Str","c":"Map tiles"}]]},{"t":"Para","c":[{"t":"Str","c":"Now that we have our space, we can generate tiled images for each prefix:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"A single tile containing the average publication dates for the prefix 978-06"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"A single tile containing the average publication dates for the prefix 978-06"}],["publication-date-978-06-small.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"I targeted a size of ~100kB per tile, which resulted in a size of 2000 pixels times 633 ("},{"t":"Math","c":[{"t":"InlineMath"},"=2000/\\sqrt{10}"]},{"t":"Str","c":")."}]},{"t":"Para","c":[{"t":"Str","c":"For each dataset, we store different information per pixel. In this case, I subtracted 1800 from the publication year to get a range of 1800 to 2055 in 8 bits. The red channel contains the average publication year of each book in the pixel, the blue channel contains the ratio of books present (e.g. if 50% of books exist, blue channel would be 127/255)."}]},{"t":"Para","c":[{"t":"Str","c":"At the maximum zoom level on the other hand, I decided to map exactly 1 book to 1 pixel for accuracy:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Zoom level 4 (1 book = 1 pixel) and zoom level 3"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Zoom level 4 (1 book = 1 pixel) and zoom level 3"}],["full-zoom.png",""]]}]}]]},{"t":"Header","c":[2,["shaders",[],[]],[{"t":"Str","c":"Shaders"}]]},{"t":"Para","c":[{"t":"Str","c":"Originally I stored RGB data directly in the map tiles, but in order to increase the flexibility I decided to store more abstract data, and do the actual rendering on the GPU using GLSL Shaders. This has a few advantages:"}]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"Color scheme can be chosen later"}]}],[{"t":"Plain","c":[{"t":"Str","c":"We can apply arbitrary transformation or filters that apply instantly"}]}],[{"t":"Plain","c":[{"t":"Str","c":"We can combine multiple datasets on the fly"}]}]]},{"t":"Para","c":[{"t":"Str","c":"For example, let’s take the publisher dataset. We store years from 1800 to 2055. But 95% of data is in the range 1985 to 2024. So we can reduce it to this range in the shader, which looks like this:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"vec4 colorOfPixel(vec2 uv) {\n  vec4 bookColor = texture2D($dataset_publication_date, uv);\n  // average publication year in this pixel\n  float publicationYear = (bookColor.r * 255.) + 1800.;\n  // 0-100% number of books exist\n  float fillRate = bookColor.b;\n  float minYear = 1985.;\n  float maxYear = 2025.;\n  float brightness = fillRate;\n  // scale year to range 0 to 1\n  float lerp = clamp((publicationYear - minYear) / (maxYear - minYear), 0., 1.);\n  return heatmapColor(lerp) * brightness;\n}"]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"vec4 heatmapColor(float)"]},{"t":"Str","c":" is a function that converts a 0-1 value to the chosen color scale of the user, by sampling another texture."}]},{"t":"Para","c":[{"t":"Str","c":"Of course, we can also easily play with non-linear scales and adjust ranges as we want."}]},{"t":"Para","c":[{"t":"Str","c":"Here’s an example that compares two datasets:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"vec4 colorOfPixel(vec2 uv) {\n  vec4 present_all = texture2D($dataset_all, uv);\n  vec4 present_md5 = texture2D($dataset_md5, uv);\n\n  vec4 present_gradient = heatmapColor(present_md5.x / present_all.x) * brightnessWithGlow(present_all.x);\n  // add publishers only in background (when brightness of gradient \u003e 0.1);\n  float publisherStrength = length(present_gradient) \u003e 1.1 ? 0.0 : PUBLISHERS_BRIGHTNESS;\n  return postprocessColor(present_gradient, publisherStrength);\n}"]},{"t":"Para","c":[{"t":"Str","c":"The "},{"t":"Code","c":[["",[],[]],"$dataset_x"]},{"t":"Str","c":" syntax is not part of GLSL, but rather a very simple (regex) templating syntax, that allows me to only load the images that the shader actually reads from."}]},{"t":"Para","c":[{"t":"Str","c":"You can edit the used shader directly in the visualization by going to the "},{"t":"Strong","c":[{"t":"Str","c":"⚙️ Advanced"}]},{"t":"Str","c":" options, it updates live. The meaning of the pixels in each dataset is described in "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"the readme"}],["https://github.com/phiresky/isbn-visualization",""]]},{"t":"Str","c":"."}]},{"t":"Header","c":[3,["the-bookshelf-view",[],[]],[{"t":"Str","c":"The bookshelf-view"}]]},{"t":"Para","c":[{"t":"Str","c":"In order to improve the visuals, at the fully zoomed in view, each pixel gets a styling resembling a book:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Side-by-side comparison of the bookshelf-shader disabled and enabled (toggleable in advanced options). Each book is assigned a random width, height, and pattern."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Side-by-side comparison of the bookshelf-shader disabled and enabled (toggleable in advanced options). Each book is assigned a random width, height, and pattern."}],["bookshelf-example.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"It’s not really what books looks like, but it makes the fully zoomed in view look much more alive. This styling is purely "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"implemented in the shader"}],["https://github.com/phiresky/isbn-visualization/blob/master/src/lib/shaders.ts#L105-L151",""]]},{"t":"Str","c":". The hardest part was getting a random-number generator to work the same within GLSL and JavaScript, since we need to know the book-height in order to set the text boundaries."}]},{"t":"Para","c":[{"t":"Str","c":"Since the styling is in the shader, we can make it smoothly appear by simply passing in the current zoom as an uniform and fading it in:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"uniform float CURRENT_ZOOM;\n\nvec4 bookshelfOverlayDependingOnZoom(vec4 bookColor) {\n  float minZoom = 90.0;\n  if (CURRENT_ZOOM \u003c minZoom) return bookColor;\n  float maxZoom = minZoom * sqrt(10.0); // fade between two zoom levels\n  vec4 overlay = bookshelfOverlay(bookColor);\n  float fadeIn = clamp((CURRENT_ZOOM - minZoom) / (maxZoom - minZoom), 0.0, 1.0);\n  return mix(bookColor, overlay, fadeIn);\n}"]},{"t":"Para","c":[{"t":"Str","c":"As far as I know, shaders work in ~32x32 pixel blocks in lockstep, which means that "},{"t":"Emph","c":[{"t":"Str","c":"every branch"}]},{"t":"Str","c":" that happens in "},{"t":"Emph","c":[{"t":"Str","c":"any pixel"}]},{"t":"Str","c":" in a block needs to be executed. But the zoom level is the same for all pixels, so this should even be performant."}]},{"t":"Header","c":[2,["trees-text-performance",[],[]],[{"t":"Str","c":"Trees, Text, Performance"}]]},{"t":"Para","c":[{"t":"Str","c":"Just like the image tiles, I render text in a hierarchical structure depending on zoom levels and view frustrum culling. Everything is implemented using "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"react-threejs-fiber"}],["https://r3f.docs.pmnd.rs",""]]},{"t":"Str","c":". The scene is described declaratively, React recursively adds scene elements as the view is moved around. Here’s an approximation of what the hierarchical Tree component looks like:"}]},{"t":"CodeBlock","c":[["",["typescript"],[]],"function RenderTree(props: { prefix: IsbnPrefixWithDashes }) {\n  // compute where we should place text and whether we should render children.\n  // depends on current view frustrum and zoom level\n  const { plane, renderChildren } = getDetailLevel(props.prefix);\n  // load prefix details asynchronously using a mobx observable\n  const prefixDetails = useMemo(\n    () =\u003e fromPromise(getPrefixDetails(props.prefix)),\n    [props.prefix]);\n  // load the relevant textures for the dataset and create a GLSL material\n  const material = useMemo(\n    () =\u003e fromPromise(getIsbnShaderMaterial(props.prefix)),\n    [props.prefix]);\n\n  return (\n    // these elements are part of the threejs WebGL scene graph\n    \u003cgroup position={plane.position}\u003e\n      \u003cPlane args={plane.size} material={material} /\u003e\n      {/* opt out of the threejs scene graph and add a html element\n          instead, using 3D CSS transforms */}\n      \u003cHtml\u003e\n        {prefixDetails.state === \"fulfilled\" \u0026\u0026\n          prefixDetails.value.publisherName}...\n      \u003c/Html\u003e\n      {renderChildren \u0026\u0026\n        digits.map((i) =\u003e\n          \u003cRenderTree prefix={props.prefix + i} /\u003e\n        )}\n    \u003c/group\u003e\n  );\n};"]},{"t":"Para","c":[{"t":"Str","c":"I had lots of performance problems initially with rendering a lot of text this way. I spent a lot of time trying and failing to render text into images/canvas in JS without having to implement my own text wrapping and layouting engine. The best approach was to "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"embed the HTML as a "},{"t":"Code","c":[["",[],[]],"\u003cforeignObject /\u003e"]},{"t":"Str","c":" within an SVG"}],["https://stackoverflow.com/a/25760896/2639190",""]]},{"t":"Str","c":", then render that to a canvas using "},{"t":"Code","c":[["",[],[]],"drawImage"]},{"t":"Str","c":", then converting that to an image and loading it as a texture."}]},{"t":"Para","c":[{"t":"Str","c":"This works, but it caused "},{"t":"Code","c":[["",[],[]],"20ms"]},{"t":"Str","c":" lags every time, synchronously in the rendering process. I struggled to move this to a WebWorker, but it turns out "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"it’s impossible to draw an SVG in a WebWorker"}],["https://stackoverflow.com/a/79196371/2639190",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"After all this frustrating effort, it turns out I could fix most of my performance concerns by just reducing the HTML elements, limiting DOM content added per frame, and especially removing a stack of "},{"t":"Code","c":[["",[],[]],"text-shadow"]},{"t":"Str","c":" CSS filters, which are apparently horrible for performance."}]},{"t":"Header","c":[2,["barcodes",[],[]],[{"t":"Str","c":"Barcodes"}]]},{"t":"Para","c":[{"t":"Str","c":"At max zoom, you will also notice that each book has a barcode. I mainly added these to reinforce the concept of what we are looking at: Books ordered by ISBN. I started with some libraries to render bar codes, but it turns out there’s actually a TTF font that just renders a 13-digit number as a barcode! It even calculates the check digit itself: "},{"t":"Link","c":[["",["auto-linked"],[]],[{"t":"Str","c":"https://graphicore.github.io/librebarcode/"}],["https://graphicore.github.io/librebarcode/",""]]},{"t":"Str","c":". Pretty convenient, and performant too, due to all the optimization OSs do for text rendering."}]},{"t":"Header","c":[2,["publisher-ranges",[],[]],[{"t":"Str","c":"Publisher ranges"}]]},{"t":"Para","c":[{"t":"Str","c":"Each "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"group"}]]},{"t":"Str","c":" (usually countries) has a large range, and each publisher has a smaller range within a group. I decided to visualize this using randomly assigned colors unique for each group and publisher:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Looking at publishers shows their range size. If a publisher has multiple ranges the color is the same."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Looking at publishers shows their range size. If a publisher has multiple ranges the color is the same."}],["publishers.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"In order to allow highlighting all ranges of a publisher simultaneously, I simply give each publisher a unique ID and store this as the RGB components:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"  ivec4 data = getIntegerRGB(texture2D($dataset_publishers, vUv));\n  int publisherId = data.r * 65536 + data.g * 256 + data.b;\n  if (HIGHLIGHTED_PUBLISHER_ID == publisherId) {\n    return vec4(1.); // white\n  }"]},{"t":"Para","c":[{"t":"Str","c":"This part I’m not extremely happy with. The publisher colors clash with the heatmap color scale, and country ranges are hard to see."}]},{"t":"Header","c":[2,["flight",[],[]],[{"t":"Str","c":"Flight"}]]},{"t":"Para","c":[{"t":"Str","c":"If you search for a book or click on the minimap, you will fly there. Calculating a good looking flight path is actually much trickier than it seems. I’m not sure how Google Earth does it. After getting a mediocre result by fitting a parabola, I nerd sniped a friend of mine to get him to do it, here’s what he said:"}]},{"t":"BlockQuote","c":[{"t":"Para","c":[{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Somehow you’re pretending reality is polar coordinates and converting that to cartesian coordinates?"}]]},{"t":"Str","c":" - "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Yes it transforms the points into a space which has the property that for a certain zoom level (which you potentially can’t reach at all) all coordinates lie on one point but all ground points are still the same distance away… aka a semicircle (or less) where the edge of the circle has the xy points zoomed in at maximum… in other words, a space that represents the speed and spatiality of the original space in one… in which the direct route is then theoretically the fastest route…. Unfortunately, this only applies if the increase in speed depends linearly on the zoom level…. but this is not the case with normal zooming… there it is rather quadratic… so every zoom level further up makes you move twice as fast to the right left… but this somehow results in a strange non-linear space with strange properties and I haven’t managed to define a distance metric in there, let alone the shortest path between two points"}]]}]},{"t":"Para","c":[{"t":"Str","c":"– my friend rambling about calculating flight paths"}]}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Blub-space transformation for smooth flight paths. This is what he sent me to try and explain it."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Blub-space transformation for smooth flight paths. This is what he sent me to try and explain it."}],["blub-space.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"The end result isn’t perfect and it feels a bit overengineered at 500 lines of code, but it works better than my original approach."}]},{"t":"Header","c":[2,["architecture",[],[]],[{"t":"Str","c":"Architecture"}]]},{"t":"Header","c":[3,["backend",[],[]],[{"t":"Str","c":"Backend"}]]},{"t":"Para","c":[{"t":"Str","c":"Since we can just store our image tiles as PNG and our data trees as JSON, we don’t need any backend! We just need a static file host, like Github Pages to dump some HTML, JS, CSS, PNG, and JSON."}]},{"t":"Header","c":[3,["frontend",[],[]],[{"t":"Str","c":"Frontend"}]]},{"t":"Para","c":[{"t":"Str","c":"I used ThreeJS, React, MobX. This is a very comfortable combination to create reactive declarative GPU-accelerated 2D/3D-scenes, with easy reusability of components. I can recommend it."}]},{"t":"Header","c":[2,["processing-scripts",[],[]],[{"t":"Str","c":"Processing Scripts"}]]},{"t":"Para","c":[{"t":"Str","c":"There’s a set of processing scripts, mostly written in JS (directly writing out JSON and PNG files), but one of them written in Rust since it has to read in a 250GByte source file, writing output to SQLite."}]},{"t":"Header","c":[2,["conclusion",[],[]],[{"t":"Str","c":"Conclusion"}]]},{"t":"Para","c":[{"t":"Str","c":"In the end, we have a very flexible way of visualizing all books that have been published with an ISBN. I enjoyed working on this project a lot. In the end, it was made possible by what would in software be called a bad choice - using an identifier that can only barely fit enough elements. If you tried the same with UUIDs, you’d have purely vast emptiness ;)"}]},{"t":"Para","c":[{"t":"Str","c":"The source code is available at "},{"t":"Link","c":[["",["auto-linked"],[]],[{"t":"Str","c":"https://github.com/phiresky/isbn-visualization"}],["https://github.com/phiresky/isbn-visualization",""]]},{"t":"Str","c":"."}]}],"default":{"filename":"2025/visualizing-all-books-in-isbn-space.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2025-01-31","hidden":true,"references":[],"title":"Visualizing all books of the world in ISBN-Space","url2cite-link-output":"sup"},"preview":"Libraries have been trying to collect humanity’s knowledge almost since the invention of writing. In the digital age, it might actually be possible to create a comprehensive collection of all human writing meeting certain criteria. That’s what shadow libraries do - collect and share as many books","content_ast":[{"t":"Para","c":[{"t":"Str","c":"Libraries have been trying to collect humanity’s knowledge almost since the invention of writing. In the digital age, it might actually be possible to create a comprehensive collection of all human writing meeting certain criteria. That’s what "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"shadow libraries"}],["https://en.wikipedia.org/wiki/Shadow_library",""]]},{"t":"Str","c":" do - collect and share as many books as possible."}]},{"t":"Para","c":[{"t":"Str","c":"One shadow library, Anna’s Archive (which I will not link here directly due to copyright concerns), recently posed a question: "},{"t":"Emph","c":[{"t":"Str","c":"How could we effectively visualize 100,000,000 books or more at once?"}]},{"t":"Str","c":" There’s lots of data to view: Titles, authors, which countries the books come from, which publishers, how old they are, how many libraries hold them, whether they are available digitally, etc."}]},{"t":"Para","c":[{"t":"Str","c":"International Standard Book Numbers ("},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"ISBNs"}],["https://en.wikipedia.org/wiki/ISBN",""]]},{"t":"Str","c":") are 13-digit numbers that are assigned to almost all published books. Since the first three digits are fixed (currently only "},{"t":"Code","c":[["",[],[]],"978-"]},{"t":"Str","c":" and "},{"t":"Code","c":[["",[],[]],"979-"]},{"t":"Str","c":") and the last digit is a checksum, this means "},{"t":"Strong","c":[{"t":"Str","c":"the total ISBN13-Space only has two billion slots"}]},{"t":"Str","c":". Here is my interactive visualization of that space:"}]},{"t":"Para","c":[{"t":"Link","c":[["",[],[["target","_blank"]]],[{"t":"Str","c":"Click here to view the visualization in full screen (esp. on mobile)"}],["https://phiresky.github.io/isbn-visualization/",""]]},{"t":"Str","c":"."}]},{"t":"Div","c":[["",["isbn-visualization-iframe-container"],[]],[{"t":"RawBlock","c":["html","\u003ciframe src=\"https://phiresky.github.io/isbn-visualization/\" class=\"isbn-visualization-iframe\"\u003e"]},{"t":"Plain","c":[{"t":"Str","c":"."}]},{"t":"RawBlock","c":["html","\u003c/iframe\u003e"]}]]},{"t":"Para","c":[{"t":"Str","c":"You can choose a few different datasets, look for individual books, filter by publication year, and even create a custom visualization based on multiple datasets using custom shaders. If you zoom in all the way, you get a nice bookshelf-like representation."}]},{"t":"Para","c":[{"t":"Str","c":"Here’s how I did it."}]},{"t":"Header","c":[2,["the-inherent-structure-of-isbns",[],[]],[{"t":"Str","c":"The inherent structure of ISBNs"}]]},{"t":"Para","c":[{"t":"Str","c":"The "},{"t":"Code","c":[["",[],[]],"978-"]},{"t":"Str","c":"/"},{"t":"Code","c":[["",[],[]],"979-"]},{"t":"Str","c":" prefix of an ISBN comes from the fact that ISBN13s are a subset of "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"European Article Numbers"}],["https://en.wikipedia.org/wiki/International_Article_Number",""]]},{"t":"Str","c":", which have a three-digit prefix. This fixed prefix is affectionately called "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"Bookland"}],["https://en.wikipedia.org/wiki/Bookland",""]]},{"t":"Str","c":". We can thus ignore it almost completely."}]},{"t":"Para","c":[{"t":"Str","c":"Large blocks of 10k to 100 million ISBNs are assigned by the "},{"t":"Emph","c":[{"t":"Str","c":"International ISBN Agency"}]},{"t":"Str","c":" to international organizations. Then, each country has their own method of subdividing their blocks into publishers."}]},{"t":"Para","c":[{"t":"Str","c":"The important part is that ISBN blocks are always assigned by "},{"t":"Strong","c":[{"t":"Str","c":"prefix"}]},{"t":"Str","c":". For example, "},{"t":"Code","c":[["",[],[]],"978-4"]},{"t":"Str","c":" is assigned to Japan, and Japan assigned "},{"t":"Code","c":[["",[],[]],"978-4-312"]},{"t":"Str","c":" to one publisher. That publisher then assigns the articles "},{"t":"Code","c":[["",[],[]],"000000-99999"]},{"t":"Str","c":", leading to an ISBN of "},{"t":"Code","c":[["",[],[]],"978-4-312-99999-X"]},{"t":"Str","c":", where X is a checksum. The longer the country prefix is, the fewer books can be assigned within it. For example, while Japan has a space of 100 million ISBNs, Singapore has a prefix of "},{"t":"Code","c":[["",[],[]],"978-9971-"]},{"t":"Str","c":", allowing only 100 thousand ISBNs."}]},{"t":"Header","c":[3,["space-filling-curves",[],[]],[{"t":"Str","c":"Space-filling curves"}]]},{"t":"Para","c":[{"t":"Str","c":"Stripping ISBNs of their pre-and suffix, they are a single decimal between 0 and 2 billion. We need some way to project this one-dimensional space into a two-dimensional space. The easiest way would be to simply fill pixels row-wise from the top, which results in an image like this:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"ISBN-Space presented linearly. Whiter pixels contain more books. You can see the line-stretched structure."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"ISBN-Space presented linearly. Whiter pixels contain more books. You can see the line-stretched structure."}],["./oclc_isbns_smaller.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"The issue with this is that smaller regions are stretched more and more horizontally, at the extreme a region is 1000 pixels wide and 1 pixel high. This makes it hard to see the inherent structure of ISBNs."}]},{"t":"Para","c":[{"t":"Str","c":"Thus, "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"as people on Hacker News discussed"}],["https://news.ycombinator.com/item?id=42652577",""]]},{"t":"Str","c":", a better way to fill an image is using a "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"space-filling curve"}],["https://en.wikipedia.org/wiki/Space-filling_curve",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"The commonly suggested Hilbert-curve is nice, but it leads to artifacts:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Left: a Hilbert curve. Right: ISBN-space projected into a hilbert curve. You can see that the regions look like they have spatial structure, but this is purely an artifact of the curve used. (credit: Wikipedia, Hypha A)"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Left: a Hilbert curve. Right: ISBN-space projected into a hilbert curve. You can see that the regions look like they have spatial structure, but this is purely an artifact of the curve used. (credit: Wikipedia, Hypha A)"}],["hilbert.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"While the Hilbert curve helps make regions more "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"square"}]]},{"t":"Str","c":" (smaller regions do not get wider and wider), it introduces structure where there is none. Since structures that are not actually part of data are a huge issue in data visualization, we want to avoid this."}]},{"t":"Header","c":[3,["the-bookshelf-curve",[],[]],[{"t":"Str","c":"The "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Bookshelf"}]]},{"t":"Str","c":"-Curve"}]]},{"t":"Para","c":[{"t":"Str","c":"ISBNs are inherently decimal, and we can use this to create a space-filling curve that is both simple to implement, easy to understand, and visually appealing:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"The space-filling curve I call "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Bookshelf-Curve"}]]},{"t":"Str","c":" because each second layer looks like an upright bookshelf, and each other layer like a stack of books."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"The space-filling curve I call "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Bookshelf-Curve"}]]},{"t":"Str","c":" because each second layer looks like an upright bookshelf, and each other layer like a stack of books."}],["bookshelf-curve.drawio.svg",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"The first decimal layer contains the digits 0-9 next to each other, the next one has them on top of each other, recursively. If we want to keep the aspect ratio of the rectangles on the first layer "},{"t":"Math","c":[{"t":"InlineMath"},"(a\\times b)"]},{"t":"Str","c":" and second layer "},{"t":"Math","c":[{"t":"InlineMath"},"(b \\times c)"]},{"t":"Str","c":" the same, this leads to an aspect ratio of each block of 3.16 to 1:"}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\frac{a}{b} = \\frac{b}{c}. "]}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\frac{a}{c} = \\frac{10}{1}. "]}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\implies \\frac{a}{b} = \\frac{10\\cdot b}{a} \\implies \\frac{a^2}{b^2} = 10 "]}]},{"t":"Para","c":[{"t":"Math","c":[{"t":"DisplayMath"}," \\implies a:b = \\sqrt{10} \\approx 3.16:1 "]}]},{"t":"Para","c":[{"t":"Str","c":"This is very similar to "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"A4 paper"}],["https://en.wikipedia.org/wiki/ISO_216",""]]},{"t":"Str","c":", which is defined as follows: Take a rectangle of size "},{"t":"Math","c":[{"t":"InlineMath"},"1m^2"]},{"t":"Str","c":", such that if you fold it in half you get a rectangle of the same aspect ratio. The first recursive iteration is A0-paper, the fourth iteration is A4. They all have an aspect ratio of "},{"t":"Math","c":[{"t":"InlineMath"},"1:\\sqrt{2}"]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"We just divide each paper into ten sections, not two. Even better, with this curve, the coordinate transformation is really simple!"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Transforming an ISBN into coordinates by simply taking every second digit"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Transforming an ISBN into coordinates by simply taking every second digit"}],["coordinates.drawio.svg",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"This transformation is really simple, but this took me ages to realize and I tried to generalize it, so my code for it is "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"50 lines"}],["https://github.com/phiresky/isbn-visualization/blob/master/src/projections/bookshelf.ts#L49-L100",""]]},{"t":"Str","c":"."}]},{"t":"Header","c":[2,["map-tiles",[],[]],[{"t":"Str","c":"Map tiles"}]]},{"t":"Para","c":[{"t":"Str","c":"Now that we have our space, we can generate tiled images for each prefix:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"A single tile containing the average publication dates for the prefix 978-06"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"A single tile containing the average publication dates for the prefix 978-06"}],["publication-date-978-06-small.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"I targeted a size of ~100kB per tile, which resulted in a size of 2000 pixels times 633 ("},{"t":"Math","c":[{"t":"InlineMath"},"=2000/\\sqrt{10}"]},{"t":"Str","c":")."}]},{"t":"Para","c":[{"t":"Str","c":"For each dataset, we store different information per pixel. In this case, I subtracted 1800 from the publication year to get a range of 1800 to 2055 in 8 bits. The red channel contains the average publication year of each book in the pixel, the blue channel contains the ratio of books present (e.g. if 50% of books exist, blue channel would be 127/255)."}]},{"t":"Para","c":[{"t":"Str","c":"At the maximum zoom level on the other hand, I decided to map exactly 1 book to 1 pixel for accuracy:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Zoom level 4 (1 book = 1 pixel) and zoom level 3"}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Zoom level 4 (1 book = 1 pixel) and zoom level 3"}],["full-zoom.png",""]]}]}]]},{"t":"Header","c":[2,["shaders",[],[]],[{"t":"Str","c":"Shaders"}]]},{"t":"Para","c":[{"t":"Str","c":"Originally I stored RGB data directly in the map tiles, but in order to increase the flexibility I decided to store more abstract data, and do the actual rendering on the GPU using GLSL Shaders. This has a few advantages:"}]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"Color scheme can be chosen later"}]}],[{"t":"Plain","c":[{"t":"Str","c":"We can apply arbitrary transformation or filters that apply instantly"}]}],[{"t":"Plain","c":[{"t":"Str","c":"We can combine multiple datasets on the fly"}]}]]},{"t":"Para","c":[{"t":"Str","c":"For example, let’s take the publisher dataset. We store years from 1800 to 2055. But 95% of data is in the range 1985 to 2024. So we can reduce it to this range in the shader, which looks like this:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"vec4 colorOfPixel(vec2 uv) {\n  vec4 bookColor = texture2D($dataset_publication_date, uv);\n  // average publication year in this pixel\n  float publicationYear = (bookColor.r * 255.) + 1800.;\n  // 0-100% number of books exist\n  float fillRate = bookColor.b;\n  float minYear = 1985.;\n  float maxYear = 2025.;\n  float brightness = fillRate;\n  // scale year to range 0 to 1\n  float lerp = clamp((publicationYear - minYear) / (maxYear - minYear), 0., 1.);\n  return heatmapColor(lerp) * brightness;\n}"]},{"t":"Para","c":[{"t":"Code","c":[["",[],[]],"vec4 heatmapColor(float)"]},{"t":"Str","c":" is a function that converts a 0-1 value to the chosen color scale of the user, by sampling another texture."}]},{"t":"Para","c":[{"t":"Str","c":"Of course, we can also easily play with non-linear scales and adjust ranges as we want."}]},{"t":"Para","c":[{"t":"Str","c":"Here’s an example that compares two datasets:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"vec4 colorOfPixel(vec2 uv) {\n  vec4 present_all = texture2D($dataset_all, uv);\n  vec4 present_md5 = texture2D($dataset_md5, uv);\n\n  vec4 present_gradient = heatmapColor(present_md5.x / present_all.x) * brightnessWithGlow(present_all.x);\n  // add publishers only in background (when brightness of gradient \u003e 0.1);\n  float publisherStrength = length(present_gradient) \u003e 1.1 ? 0.0 : PUBLISHERS_BRIGHTNESS;\n  return postprocessColor(present_gradient, publisherStrength);\n}"]},{"t":"Para","c":[{"t":"Str","c":"The "},{"t":"Code","c":[["",[],[]],"$dataset_x"]},{"t":"Str","c":" syntax is not part of GLSL, but rather a very simple (regex) templating syntax, that allows me to only load the images that the shader actually reads from."}]},{"t":"Para","c":[{"t":"Str","c":"You can edit the used shader directly in the visualization by going to the "},{"t":"Strong","c":[{"t":"Str","c":"⚙️ Advanced"}]},{"t":"Str","c":" options, it updates live. The meaning of the pixels in each dataset is described in "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"the readme"}],["https://github.com/phiresky/isbn-visualization",""]]},{"t":"Str","c":"."}]},{"t":"Header","c":[3,["the-bookshelf-view",[],[]],[{"t":"Str","c":"The bookshelf-view"}]]},{"t":"Para","c":[{"t":"Str","c":"In order to improve the visuals, at the fully zoomed in view, each pixel gets a styling resembling a book:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Side-by-side comparison of the bookshelf-shader disabled and enabled (toggleable in advanced options). Each book is assigned a random width, height, and pattern."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Side-by-side comparison of the bookshelf-shader disabled and enabled (toggleable in advanced options). Each book is assigned a random width, height, and pattern."}],["bookshelf-example.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"It’s not really what books looks like, but it makes the fully zoomed in view look much more alive. This styling is purely "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"implemented in the shader"}],["https://github.com/phiresky/isbn-visualization/blob/master/src/lib/shaders.ts#L105-L151",""]]},{"t":"Str","c":". The hardest part was getting a random-number generator to work the same within GLSL and JavaScript, since we need to know the book-height in order to set the text boundaries."}]},{"t":"Para","c":[{"t":"Str","c":"Since the styling is in the shader, we can make it smoothly appear by simply passing in the current zoom as an uniform and fading it in:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"uniform float CURRENT_ZOOM;\n\nvec4 bookshelfOverlayDependingOnZoom(vec4 bookColor) {\n  float minZoom = 90.0;\n  if (CURRENT_ZOOM \u003c minZoom) return bookColor;\n  float maxZoom = minZoom * sqrt(10.0); // fade between two zoom levels\n  vec4 overlay = bookshelfOverlay(bookColor);\n  float fadeIn = clamp((CURRENT_ZOOM - minZoom) / (maxZoom - minZoom), 0.0, 1.0);\n  return mix(bookColor, overlay, fadeIn);\n}"]},{"t":"Para","c":[{"t":"Str","c":"As far as I know, shaders work in ~32x32 pixel blocks in lockstep, which means that "},{"t":"Emph","c":[{"t":"Str","c":"every branch"}]},{"t":"Str","c":" that happens in "},{"t":"Emph","c":[{"t":"Str","c":"any pixel"}]},{"t":"Str","c":" in a block needs to be executed. But the zoom level is the same for all pixels, so this should even be performant."}]},{"t":"Header","c":[2,["trees-text-performance",[],[]],[{"t":"Str","c":"Trees, Text, Performance"}]]},{"t":"Para","c":[{"t":"Str","c":"Just like the image tiles, I render text in a hierarchical structure depending on zoom levels and view frustrum culling. Everything is implemented using "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"react-threejs-fiber"}],["https://r3f.docs.pmnd.rs",""]]},{"t":"Str","c":". The scene is described declaratively, React recursively adds scene elements as the view is moved around. Here’s an approximation of what the hierarchical Tree component looks like:"}]},{"t":"CodeBlock","c":[["",["typescript"],[]],"function RenderTree(props: { prefix: IsbnPrefixWithDashes }) {\n  // compute where we should place text and whether we should render children.\n  // depends on current view frustrum and zoom level\n  const { plane, renderChildren } = getDetailLevel(props.prefix);\n  // load prefix details asynchronously using a mobx observable\n  const prefixDetails = useMemo(\n    () =\u003e fromPromise(getPrefixDetails(props.prefix)),\n    [props.prefix]);\n  // load the relevant textures for the dataset and create a GLSL material\n  const material = useMemo(\n    () =\u003e fromPromise(getIsbnShaderMaterial(props.prefix)),\n    [props.prefix]);\n\n  return (\n    // these elements are part of the threejs WebGL scene graph\n    \u003cgroup position={plane.position}\u003e\n      \u003cPlane args={plane.size} material={material} /\u003e\n      {/* opt out of the threejs scene graph and add a html element\n          instead, using 3D CSS transforms */}\n      \u003cHtml\u003e\n        {prefixDetails.state === \"fulfilled\" \u0026\u0026\n          prefixDetails.value.publisherName}...\n      \u003c/Html\u003e\n      {renderChildren \u0026\u0026\n        digits.map((i) =\u003e\n          \u003cRenderTree prefix={props.prefix + i} /\u003e\n        )}\n    \u003c/group\u003e\n  );\n};"]},{"t":"Para","c":[{"t":"Str","c":"I had lots of performance problems initially with rendering a lot of text this way. I spent a lot of time trying and failing to render text into images/canvas in JS without having to implement my own text wrapping and layouting engine. The best approach was to "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"embed the HTML as a "},{"t":"Code","c":[["",[],[]],"\u003cforeignObject /\u003e"]},{"t":"Str","c":" within an SVG"}],["https://stackoverflow.com/a/25760896/2639190",""]]},{"t":"Str","c":", then render that to a canvas using "},{"t":"Code","c":[["",[],[]],"drawImage"]},{"t":"Str","c":", then converting that to an image and loading it as a texture."}]},{"t":"Para","c":[{"t":"Str","c":"This works, but it caused "},{"t":"Code","c":[["",[],[]],"20ms"]},{"t":"Str","c":" lags every time, synchronously in the rendering process. I struggled to move this to a WebWorker, but it turns out "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"it’s impossible to draw an SVG in a WebWorker"}],["https://stackoverflow.com/a/79196371/2639190",""]]},{"t":"Str","c":"."}]},{"t":"Para","c":[{"t":"Str","c":"After all this frustrating effort, it turns out I could fix most of my performance concerns by just reducing the HTML elements, limiting DOM content added per frame, and especially removing a stack of "},{"t":"Code","c":[["",[],[]],"text-shadow"]},{"t":"Str","c":" CSS filters, which are apparently horrible for performance."}]},{"t":"Header","c":[2,["barcodes",[],[]],[{"t":"Str","c":"Barcodes"}]]},{"t":"Para","c":[{"t":"Str","c":"At max zoom, you will also notice that each book has a barcode. I mainly added these to reinforce the concept of what we are looking at: Books ordered by ISBN. I started with some libraries to render bar codes, but it turns out there’s actually a TTF font that just renders a 13-digit number as a barcode! It even calculates the check digit itself: "},{"t":"Link","c":[["",["auto-linked"],[]],[{"t":"Str","c":"https://graphicore.github.io/librebarcode/"}],["https://graphicore.github.io/librebarcode/",""]]},{"t":"Str","c":". Pretty convenient, and performant too, due to all the optimization OSs do for text rendering."}]},{"t":"Header","c":[2,["publisher-ranges",[],[]],[{"t":"Str","c":"Publisher ranges"}]]},{"t":"Para","c":[{"t":"Str","c":"Each "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"group"}]]},{"t":"Str","c":" (usually countries) has a large range, and each publisher has a smaller range within a group. I decided to visualize this using randomly assigned colors unique for each group and publisher:"}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Looking at publishers shows their range size. If a publisher has multiple ranges the color is the same."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Looking at publishers shows their range size. If a publisher has multiple ranges the color is the same."}],["publishers.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"In order to allow highlighting all ranges of a publisher simultaneously, I simply give each publisher a unique ID and store this as the RGB components:"}]},{"t":"CodeBlock","c":[["",["glsl"],[]],"  ivec4 data = getIntegerRGB(texture2D($dataset_publishers, vUv));\n  int publisherId = data.r * 65536 + data.g * 256 + data.b;\n  if (HIGHLIGHTED_PUBLISHER_ID == publisherId) {\n    return vec4(1.); // white\n  }"]},{"t":"Para","c":[{"t":"Str","c":"This part I’m not extremely happy with. The publisher colors clash with the heatmap color scale, and country ranges are hard to see."}]},{"t":"Header","c":[2,["flight",[],[]],[{"t":"Str","c":"Flight"}]]},{"t":"Para","c":[{"t":"Str","c":"If you search for a book or click on the minimap, you will fly there. Calculating a good looking flight path is actually much trickier than it seems. I’m not sure how Google Earth does it. After getting a mediocre result by fitting a parabola, I nerd sniped a friend of mine to get him to do it, here’s what he said:"}]},{"t":"BlockQuote","c":[{"t":"Para","c":[{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Somehow you’re pretending reality is polar coordinates and converting that to cartesian coordinates?"}]]},{"t":"Str","c":" - "},{"t":"Quoted","c":[{"t":"DoubleQuote"},[{"t":"Str","c":"Yes it transforms the points into a space which has the property that for a certain zoom level (which you potentially can’t reach at all) all coordinates lie on one point but all ground points are still the same distance away… aka a semicircle (or less) where the edge of the circle has the xy points zoomed in at maximum… in other words, a space that represents the speed and spatiality of the original space in one… in which the direct route is then theoretically the fastest route…. Unfortunately, this only applies if the increase in speed depends linearly on the zoom level…. but this is not the case with normal zooming… there it is rather quadratic… so every zoom level further up makes you move twice as fast to the right left… but this somehow results in a strange non-linear space with strange properties and I haven’t managed to define a distance metric in there, let alone the shortest path between two points"}]]}]},{"t":"Para","c":[{"t":"Str","c":"– my friend rambling about calculating flight paths"}]}]},{"t":"Figure","c":[["",[],[]],[null,[{"t":"Plain","c":[{"t":"Str","c":"Blub-space transformation for smooth flight paths. This is what he sent me to try and explain it."}]}]],[{"t":"Plain","c":[{"t":"Image","c":[["",[],[]],[{"t":"Str","c":"Blub-space transformation for smooth flight paths. This is what he sent me to try and explain it."}],["blub-space.png",""]]}]}]]},{"t":"Para","c":[{"t":"Str","c":"The end result isn’t perfect and it feels a bit overengineered at 500 lines of code, but it works better than my original approach."}]},{"t":"Header","c":[2,["architecture",[],[]],[{"t":"Str","c":"Architecture"}]]},{"t":"Header","c":[3,["backend",[],[]],[{"t":"Str","c":"Backend"}]]},{"t":"Para","c":[{"t":"Str","c":"Since we can just store our image tiles as PNG and our data trees as JSON, we don’t need any backend! We just need a static file host, like Github Pages to dump some HTML, JS, CSS, PNG, and JSON."}]},{"t":"Header","c":[3,["frontend",[],[]],[{"t":"Str","c":"Frontend"}]]},{"t":"Para","c":[{"t":"Str","c":"I used ThreeJS, React, MobX. This is a very comfortable combination to create reactive declarative GPU-accelerated 2D/3D-scenes, with easy reusability of components. I can recommend it."}]},{"t":"Header","c":[2,["processing-scripts",[],[]],[{"t":"Str","c":"Processing Scripts"}]]},{"t":"Para","c":[{"t":"Str","c":"There’s a set of processing scripts, mostly written in JS (directly writing out JSON and PNG files), but one of them written in Rust since it has to read in a 250GByte source file, writing output to SQLite."}]},{"t":"Header","c":[2,["conclusion",[],[]],[{"t":"Str","c":"Conclusion"}]]},{"t":"Para","c":[{"t":"Str","c":"In the end, we have a very flexible way of visualizing all books that have been published with an ISBN. I enjoyed working on this project a lot. In the end, it was made possible by what would in software be called a bad choice - using an identifier that can only barely fit enough elements. If you tried the same with UUIDs, you’d have purely vast emptiness ;)"}]},{"t":"Para","c":[{"t":"Str","c":"The source code is available at "},{"t":"Link","c":[["",["auto-linked"],[]],[{"t":"Str","c":"https://github.com/phiresky/isbn-visualization"}],["https://github.com/phiresky/isbn-visualization",""]]},{"t":"Str","c":"."}]}]}}},"__N_SSG":true},"page":"/[year]/[post]","query":{"year":"2025","post":"visualizing-all-books-in-isbn-space"},"buildId":"PEPLuuxm2swHrygpZSajI","assetPrefix":"/blog","isFallback":false,"dynamicIds":[8225],"gsp":true,"scriptLoader":[]}</script></body></html>